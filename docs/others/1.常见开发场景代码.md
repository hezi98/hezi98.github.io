ğŸ’¡ğŸš€ğŸ¤ŸğŸ‘‰ğŸ‘‡â˜€ï¸ğŸ‰ğŸğŸ‡ğŸ“ğŸ¥•ğŸ­ğŸ–ï¸ğŸâ˜˜ï¸ğŸ€ğŸ’¯ğŸ”†â—ğŸ”¥ğŸš©

## å…¨é€‰/åé€‰æ¡†æ¡ˆä¾‹ğŸ’¡

1.åŸç”Ÿjs

ä½ç½®ï¼šwepAPI day3

```
<!DOCTYPE html>

<html>

<head lang="en">
  <meta charset="UTF-8">
  <title></title>
  <style>
    * {
      margin: 0;
      padding: 0;
    }

    table {
      border-collapse: collapse;
      border-spacing: 0;
      border: 1px solid #c0c0c0;
      width: 500px;
      margin: 100px auto;
      text-align: center;
    }

    th {
      background-color: #09c;
      font: bold 16px "å¾®è½¯é›…é»‘";
      color: #fff;
      height: 24px;
    }

    td {
      border: 1px solid #d0d0d0;
      color: #404060;
      padding: 10px;
    }

    .allCheck {
      width: 80px;
    }
  </style>
</head>

<body>
  <table>
    <tr>
      <th class="allCheck">
        <input type="checkbox" name="" id="checkAll"> <span class="all">å…¨é€‰</span>
      </th>
      <th>å•†å“</th>
      <th>å•†å®¶</th>
      <th>ä»·æ ¼</th>
    </tr>
    <tr>
      <td>
        <input type="checkbox" name="check" class="ck">
      </td>
      <td>å°ç±³æ‰‹æœº</td>
      <td>å°ç±³</td>
      <td>ï¿¥1999</td>
    </tr>
    <tr>
      <td>
        <input type="checkbox" name="check" class="ck">
      </td>
      <td>å°ç±³å‡€æ°´å™¨</td>
      <td>å°ç±³</td>
      <td>ï¿¥4999</td>
    </tr>
    <tr>
      <td>
        <input type="checkbox" name="check" class="ck">
      </td>
      <td>å°ç±³ç”µè§†</td>
      <td>å°ç±³</td>
      <td>ï¿¥5999</td>
    </tr>
  </table>
  <script>
    // 1. è·å–å¤§çš„å¤é€‰æ¡†
    const checkAll = document.querySelector('#checkAll')
    // 2. è·å–æ‰€æœ‰çš„å°çš„å¤é€‰æ¡†
    const cks = document.querySelectorAll('.ck')
    // 3. ç‚¹å‡»ä¸Šé¢å¤§çš„å¤é€‰æ¡†ï¼Œ ä¸‹é¢å°çš„è·Ÿéšå˜åŒ–
    checkAll.addEventListener('click', function(){
      // checkAll.checked è¡¨ç¤º ä¸Šé¢å¤é€‰æ¡† æ˜¯å¦å‹¾é€‰
      // console.log(this.checked)
      // 4. éå†æ‰€æœ‰çš„å°å¤é€‰æ¡†, è®©å¤é€‰æ¡†çš„checked ç­‰äº å¤§å¤é€‰æ¡†çš„checked  (checked å€¼ ä¸ºtrue/falseï¼Œé€‰ä¸­ä¸ºtrue)
      for (let i = 0; i < cks.length; i++) {
        cks[i].checked = this.checked
      }
    })

    // 5. å°å¤é€‰æ¡†æ§åˆ¶å¤§å¤é€‰æ¡† (åé€‰)
    for (let i = 0; i < cks.length; i++) {
      // ç»™æ¯ä¸€ä¸ªå°å¤é€‰æ¡†, ç»‘å®šç‚¹å‡»äº‹ä»¶
      cks[i].addEventListener('click', function(){
        // console.log(this)
        
        // åˆ¤æ–­æ¯æ¬¡ç‚¹å‡»çš„æ—¶å€™, è¢«é€‰ä¸­çš„å°å¤é€‰æ¡†çš„ä¸ªæ•°, æ˜¯ä¸æ˜¯ç­‰äº æ€»çš„å°å¤é€‰æ¡†çš„ä¸ªæ•°è¢«é€‰ä¸­çš„å°å¤é€‰æ¡† **.ck:checked** 
        // æ³¨æ„ï¼šæ˜¯æ¯æ¬¡ç‚¹å‡»ä¹‹åè·å–åˆ¤æ–­ï¼Œæ‰€ä»¥æ˜¯ç‚¹å‡»ä¹‹åå†è·å–è¢«é€‰ä¸­çš„å¤é€‰æ¡† 
         const checkedCks = document.querySelectorAll('.ck:checked') // è·å–æ‰€æœ‰é€‰ä¸­çš„å°å¤é€‰æ¡†
         console.log(checkedCks)
        // ä¸‹é¢ä¸€å¥è¡¨ç¤ºï¼šåˆ¤æ–­ è¢«é€‰ä¸­å°å¤é€‰æ¡†ç»„æˆçš„æ•°ç»„ çš„ é•¿åº¦ æ˜¯å¦ç­‰äº æ‰€æœ‰å°å¤é€‰æ¡†ç»„æˆçš„æ•°ç»„ çš„ é•¿åº¦
        //  å¦‚æœæ˜¯å°±ç›´æ¥èµ‹å€¼ç»™ å¤§å¤é€‰æ¡†çš„ checked
         checkAll.checked = checkedCks.length === cks.length
      })
    }
  </script>
</body>

</html>
```

2.vue å®é™…å·¥ä½œä½¿ç”¨

```vue
<template>
  <div>
    <span>å…¨é€‰:</span>
    <input type="checkbox" v-model="isAll"/>
    <button @click="qufan">åé€‰</button>
    <ul>
      <li v-for="(item, i) in arr" :key="i">
        <input type="checkbox" v-model="item.c"/>
        <span>{{ item.name }}</span>
      </li>
    </ul>
  </div>
</template>

<script>
export default {
  name: 'demo-08',
  data() {
    return {
      arr: [
        {
          name: "çŒªå…«æˆ’",
          c: false,
        },
        {
          name: "å­™æ‚Ÿç©º",
          c: false,
        },
        {
          name: "å”åƒ§",
          c: false,
        },
        {
          name: "ç™½é¾™é©¬",
          c: false,
        },
      ],
    };
  },
  computed: {
    isAll: {
      // å…¨é€‰å½±å“å°é€‰,set()çš„å‚æ•°ä¸ºé¡µé¢ä¸­æ‰‹åŠ¨ä¿®æ”¹äº†åçš„è®¡ç®—ç»“æœ
      set (value) {
        this.arr.forEach(item => item.c = value)
      },
      // å°é€‰å½±å“å…¨é€‰
      get () {
        let flag = this.arr.every(val => val.c)
        return flag
      }
    }
  },
  // å–å
  methods: {
    qufan () {
      this.arr.forEach(item => item.c = !item.c)
    }
  }
};
</script>


<style scoped>


</style>

```





## å›¾æ¡ˆä¾‹ğŸ’¡

ä½ç½®ï¼šwepAPI day2

```
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>è½®æ’­å›¾ç‚¹å‡»åˆ‡æ¢</title>
    <style>
      * {
        box-sizing: border-box;
      }

      .slider {
        width: 560px;
        height: 400px;
        overflow: hidden;
      }

      .slider-wrapper {
        width: 100%;
        height: 320px;
      }

      .slider-wrapper img {
        width: 100%;
        height: 100%;
        display: block;
      }

      .slider-footer {
        height: 80px;
        background-color: rgb(100, 67, 68);
        padding: 12px 12px 0 12px;
        position: relative;
      }

      .slider-footer .toggle {
        position: absolute;
        right: 0;
        top: 12px;
        display: flex;
      }

      .slider-footer .toggle button {
        margin-right: 12px;
        width: 28px;
        height: 28px;
        appearance: none;
        border: none;
        background: rgba(255, 255, 255, 0.1);
        color: #fff;
        border-radius: 4px;
        cursor: pointer;
      }

      .slider-footer .toggle button:hover {
        background: rgba(255, 255, 255, 0.2);
      }

      .slider-footer p {
        margin: 0;
        color: #fff;
        font-size: 18px;
        margin-bottom: 10px;
      }

      .slider-indicator {
        margin: 0;
        padding: 0;
        list-style: none;
        display: flex;
        align-items: center;
      }

      .slider-indicator li {
        width: 8px;
        height: 8px;
        margin: 4px;
        border-radius: 50%;
        background: #fff;
        opacity: 0.4;
        cursor: pointer;
      }

      .slider-indicator li.active {
        width: 12px;
        height: 12px;
        opacity: 1;
      }
    </style>
  </head>

  <body>
    <div class="slider">
      <div class="slider-wrapper">
        <img src="./images/slider01.jpg" alt="" />
      </div>
      <div class="slider-footer">
        <p>å¯¹äººç±»æ¥è¯´ä¼šä¸ä¼šå¤ªè¶…å‰äº†ï¼Ÿ</p>
        <ul class="slider-indicator">
          <li class="active"></li>
          <li></li>
          <li></li>
          <li></li>
          <li></li>
          <li></li>
          <li></li>
          <li></li>
        </ul>
        <div class="toggle">
          <button class="prev">&lt;</button>
          <button class="next">&gt;</button>
        </div>
      </div>
    </div>
    <script>
      // 1. åˆå§‹æ•°æ®
      const arr = [
        {
          url: './images/slider01.jpg',
          title: 'å¯¹äººç±»æ¥è¯´ä¼šä¸ä¼šå¤ªè¶…å‰äº†ï¼Ÿ',
          color: 'rgb(100, 67, 68)',
        },
        {
          url: './images/slider02.jpg',
          title: 'å¼€å¯å‰‘ä¸é›ªçš„é»‘æš—ä¼ è¯´ï¼',
          color: 'rgb(43, 35, 26)',
        },
        {
          url: './images/slider03.jpg',
          title: 'çœŸæ­£çš„joå¨å‡ºç°äº†ï¼',
          color: 'rgb(36, 31, 33)',
        },
        {
          url: './images/slider04.jpg',
          title: 'æç‰åˆšï¼šè®©ä¸–ç•Œé€šè¿‡Bç«™çœ‹åˆ°ä¸œæ–¹å¤§å›½æ–‡åŒ–',
          color: 'rgb(139, 98, 66)',
        },
        {
          url: './images/slider05.jpg',
          title: 'å¿«æ¥åˆ†äº«ä½ çš„å¯’å‡æ—¥å¸¸å§~',
          color: 'rgb(67, 90, 92)',
        },
        {
          url: './images/slider06.jpg',
          title: 'å“”å“©å“”å“©å°å¹´YEAH',
          color: 'rgb(166, 131, 143)',
        },
        {
          url: './images/slider07.jpg',
          title: 'ä¸€ç«™å¼è§£å†³ä½ çš„ç”µè„‘é…ç½®é—®é¢˜ï¼ï¼ï¼',
          color: 'rgb(53, 29, 25)',
        },
        {
          url: './images/slider08.jpg',
          title: 'è°ä¸æƒ³å’Œå°çŒ«å’ªè´´è´´å‘¢ï¼',
          color: 'rgb(99, 72, 114)',
        },
      ]
      // æ•´ä½“æ€è·¯åˆ†æï¼šåˆ†ä¸‰å¤§æ¿å—
      // ç¬¬ä¸€éƒ¨åˆ†ï¼šç»‘å®šç‚¹å‡»äº‹ä»¶ï¼Œå…ˆå†™å‡ºç‚¹å‡»å·¦å³ç®­å¤´çš„æ—¶å€™ï¼Œè®©å¯¹åº”çš„å†…å®¹å˜åŒ–
      // ç¬¬äºŒéƒ¨åˆ†ï¼šå°†è½®æ’­éƒ¨åˆ†çš„çš„å…¬å…±ä»£ç æŠ½ç¦»å°è£…æˆä¸€ä¸ªå‡½æ•°ï¼ˆç®€æ´ä»£ç ï¼‰
      // ç¬¬ä¸‰éƒ¨åˆ†ï¼šæ·»åŠ å®šæ—¶å™¨ï¼Œè®©å³ç®­å¤´æ¯è¿‡ä¸€æ®µæ—¶é—´è‡ªåŠ¨ç‚¹å‡»ï¼Œæ¨¡æ‹Ÿè‡ªåŠ¨æ’­æ”¾çš„æ•ˆæœï¼ˆä½¿ç”¨ï¼šå…ƒç´ .click() ï¼‰
      // ç¬¬å››éƒ¨åˆ†ï¼šç»‘å®šmouseenter å’Œ mouseleave å…³é—­å’Œå¼€å¯ç¬¬ä¸‰éƒ¨åˆ†æ·»åŠ çš„å®šæ—¶å™¨

      // ç¬¬ä¸€éƒ¨åˆ†
      // è·å–å·¦å³ç®­å¤´
      const prev = document.querySelector('.prev')
      const next = document.querySelector('.next')
      let i = 0
      // ä¸Šä¸€ä¸ªï¼ˆprevï¼‰
      // 1. ç»‘å®šç‚¹å‡»äº‹ä»¶
      prev.addEventListener('click', function () {
        i--
        if (i === -1) {
          i = arr.length - 1
        }
        gonggong()
      })
      // å·¦ç®­å¤´
      next.addEventListener('click', function () {
        i++
        if (i === arr.length) {
          i = 0
        }
        gonggong()
      })

      // ç¬¬äºŒéƒ¨åˆ†
      // å°†è½®æ¢çš„å…¬å…±éƒ¨åˆ†æŠ½ç¦»å‡ºæ¥å°è£…æˆä¸€ä¸ªå‡½æ•°
      // 1. è·å–å¯¹åº”å…ƒç´ å¯¹è±¡ï¼ˆå›¾ç‰‡ã€æ–‡å­—ã€èƒŒæ™¯ç›’å­ã€å°åœ†ç‚¹ï¼‰
      const img = document.querySelector('.slider-wrapper img')
      const text = document.querySelector('.slider-footer p')
      const footer = document.querySelector('.slider-footer')
      function gonggong() {
        img.src = arr[i].url
        text.innerHTML = arr[i].title
        footer.style.backgroundColor = arr[i].color
        // æ”¹å˜å°åœ†ç‚¹æ ·å¼ æ’ä»–æ€æƒ³
        // å…ˆå¹²æ‰åŸæœ‰æ ·å¼
        document.querySelector('.active').classList.remove('active')
        // å†è®©è‡ªå·±æ˜¾ç¤º
        document
          .querySelector(`.slider-indicator li:nth-child(${i + 1})`)
          .classList.add('active')
      }

      // ç¬¬ä¸‰éƒ¨åˆ†
      // æ·»åŠ å®šæ—¶å™¨ï¼Œæ¨¡æ‹Ÿå³ç®­å¤´ç‚¹å‡»æ•ˆæœï¼Œè®©å†…å®¹è‡ªåŠ¨è½®æ’­
      // å¯¹è±¡.click() æ˜¯å…ƒç´ å¯¹è±¡æ‹¥æœ‰çš„æ–¹æ³•ï¼Œç”¨çš„æ—¶å€™å¯ä»¥ç›´æ¥è°ƒç”¨ï¼Œè®©å¯¹è±¡ç‚¹å‡»
      let timerId = setInterval(function () {
        next.click()
      }, 1000)

      // ç¬¬å››éƒ¨åˆ†
      // 1. è·å–æ•´ä¸ªè½®æ’­å›¾çš„å¤§ç›’å­
      const slider = document.querySelector('.slider')
      // 2.1 ç»‘å®šäº‹ä»¶mouseenter
      slider.addEventListener('mouseenter', function(){
        clearInterval(timerId)
      })
      // 2.2 ç»‘å®šäº‹ä»¶mouseleave
      slider.addEventListener('mouseleave', function(){
        timerId = setInterval(function () {
        next.click()
      }, 1000)
      })
    </script>
  </body>
</html>

```





## è·å–æ–‡ç« åˆ—è¡¨å¹¶é“ºè®¾æ•°æ®ğŸ’¡



```vue
<template>
  <div class="article-list-container">
    <van-pull-refresh v-model="refreshing" @refresh="onRefresh" :success-text="refreshInfo" success-duration="1500">
        <van-list
            v-model="loading"
            :finished="finished"
            finished-text="æ²¡æœ‰æ›´å¤šäº†"
            :error.sync="error"
            error-text="è¯·æ±‚å¤±è´¥ï¼Œç‚¹å‡»é‡æ–°åŠ è½½"
            @load="onLoad">
            <ArticleItem v-for="(item, i) in list" :key="i" :item="item" />
        </van-list>
    </van-pull-refresh>

  </div>
</template>

<script>
import { getArticlesAPI } from '../../../api/index.js'
// å¼•å…¥æ¯ç¯‡æ–‡ç« ç»„ä»¶
import ArticleItem from './article-item.vue'
export default {
  naeme: 'ArticleList',
  components: {
    ArticleItem
  },
  props: {
    channels: {
      type: Object,
      default: () => ({})
    }
  },
  data () {
    return {
      list: [],
      loading: false,
      finished: false,
      timestamp: null, // æ—¶é—´æˆ³
      error: false, // å½“è¯·æ±‚æŠ¥é”™æ—¶ï¼Œä¼šå°†erroræ”¹ä¸ºtrue ï¼Œæ­¤æ—¶ä¸ä¼šè§¦å‘ @load äº‹ä»¶ï¼Œç‚¹å‡»æŠ¥é”™æç¤ºä¸»åŠ¨è§¦å‘@load
      refreshing: false, // é˜²æŠ–ï¼Œ å½“æ‰§è¡Œä¸‹æ‹‰æ›´æ–°è¯·æ±‚æ—¶ç¦æ­¢å†è§¦å‘ @refresh äº‹ä»¶
      refreshInfo: 'åˆ·æ–°æˆåŠŸ'
    }
  },
  methods: {
      // æ³¨æ„ï¼šè¯¥æ¨¡æ¿æ˜¯ç»„åˆvantç»„ä»¶è¿›è¡Œä½¿ç”¨çš„ï¼Œä½†å…¶ä»–çš„ä¹Ÿå¯ä»¥å‚è€ƒä»¥ä¸‹æ­¥éª¤
      // ä¸»è¦ä»£ç æ¨¡æ¿
    async onLoad () { // onLoadæ˜¯vantç»„ä»¶å¸¦çš„ä¸‹æ»‘åŠ è½½äº‹ä»¶
      try {
        // 1. é€šè¿‡æ¥å£è·å–æ•°æ®å¹¶é“ºè®¾
        const { data: res } = await getArticlesAPI({
          channel_id: this.channels.id,
          timestamp: this.timestamp || Date.now()
        })
        // console.log(res)

        // 2. å°†è¿”å›çš„æ—¶é—´æˆ³èµ‹å€¼ç»™å½“å‰çš„dataä¸­çš„æ—¶é—´æˆ³ - è§†ä¸šåŠ¡å…·ä½“æƒ…å†µæ”¹å˜è¯¥æ­¥éª¤ä»£ç 
        this.timestamp = res.data.pre_timestamp

        // 3. å°†è·å–åˆ°çš„æ•°æ®æ‹¼æ¥åˆ°listæ•°ç»„ä¸­å»
        this.list.push(...res.data.results)

        // 4. åŠ è½½çŠ¶æ€ç»“æŸï¼Œå¯ä»¥è¿›è¡Œä¸‹ä¸€æ¬¡åŠ è½½åŠ¨ä½œ
        this.loading = false

        // 5. æ•°æ®å…¨éƒ¨åŠ è½½å®Œæˆï¼Œåˆ¤æ–­æ˜¯å¦è¿˜æœ‰æ•°æ®ï¼Œå¹¶ä¿®æ”¹å¯ä»¥åŠ è½½çš„çŠ¶æ€å€¼
        if (res.data.results.length === 0) {
          this.finished = true
        }
      } catch (error) {
        // 6. å½“ä»£ç æŠ¥é”™æ—¶ï¼Œä¸»åŠ¨ç»“æŸåŠ è½½çŠ¶æ€
        this.loading = false
        // 7. å½“è¯·æ±‚æŠ¥é”™æ—¶ï¼Œå¼€å¯æŠ¥é”™æç¤º
        this.error = true
        console.log(error)
      }
    },
      
    // ä¸‹æ‹‰åˆ·æ–°
    async onRefresh () {
      try {
        // 1. é€šè¿‡æ¥å£è·å–æ•°æ®å¹¶é“ºè®¾
        const { data: res } = await getArticlesAPI({
          channel_id: this.channels.id,
          timestamp: Date.now()
        })
        // 2. å°†è·å–åˆ°çš„æ•°æ®æ‹¼æ¥åˆ°listæ•°ç»„ä¸­å»
        this.list.unshift(...res.data.results)

        // 3. åŠ è½½çŠ¶æ€ç»“æŸï¼Œå¯ä»¥è¿›è¡Œä¸‹ä¸€æ¬¡åŠ è½½åŠ¨ä½œ
        this.refreshing = false
        // 3.1 åˆ·æ–°æˆåŠŸåä¿®æ”¹æç¤ºæ–‡æœ¬
        this.refreshInfo = `åˆ·æ–°æˆåŠŸï¼Œæ›´æ–°äº†${res.data.results.length}æ¡æ•°æ®`
      } catch (error) {
        // 4. å½“ä»£ç æŠ¥é”™æ—¶ï¼Œä¸»åŠ¨ç»“æŸåŠ è½½çŠ¶æ€
        this.refreshing = false
        this.refreshInfo = 'åˆ·æ–°å¤±è´¥'
        console.log(error)
      }
    }
  }
}
</script>

<style scoped lang="less">
.article-list-container{
    // è¯¥æ ·å¼æ˜¯è®¾ç½®åˆ—è¡¨æ»‘åŠ¨åŒºåŸŸé«˜åº¦é€‚åº”å±å¹•
    overflow-y: auto;
    height: 79vh;
}
</style>

```



## å°†ä¸€æ®µå­—ç¬¦ä¸²ä¸­æŒ‡å®šå­—ç¬¦ä¸²å˜é«˜äº®ğŸ’¡

åº”ç”¨ï¼šæœç´¢æ—¶çš„è”æƒ³æœç´¢ç»“æœåˆ—è¡¨

```js
// æœç´¢è”æƒ³é«˜äº®
    hightLight (str) {
      // æ–¹æ¡ˆä¸€ï¼šåˆ©ç”¨æ­£åˆ™è¡¨è¾¾å¼ + repalce()
      // const reg = new RegExp(this.searchText, 'ig')
      // return str.replace(reg, `<span style="color: blue;">${this.searchText}</span>`)

      // æ–¹æ¡ˆäºŒï¼š ä½¿ç”¨split() å’Œ join()
      const hightLightText = `<span style="color: blue;">${this.searchText}</span>`
      return str.split(this.searchText).join(hightLightText)
    }
// ä½¿ç”¨æ—¶ç›´æ¥ä½¿ç”¨è¯¥å‡½æ•°ï¼ˆéœ€è¦è¿›è¡Œä¼ å€¼ï¼‰ï¼Œå¦‚ï¼š
	<span v-html="hightLight(item)"></span>
```



## åˆ©ç”¨*cropperjs*æ’ä»¶ä¸Šä¼ å¤´åƒğŸ’¡

ç§»åŠ¨ç«¯

ä¸€ã€ä¸Šä¼ å›¾ç‰‡åŠè·å–å›¾ç‰‡

1.åˆ©ç”¨inputæ ‡ç­¾type="file"ç±»å‹ä¸Šä¼ å›¾ç‰‡,ç»‘å®šchangeäº‹ä»¶

```html
<input type="file" hidden ref="file" @change="changeAvater" >
```

2.åœ¨changeäº‹ä»¶è§¦å‘åè¿›è¡Œä»¥ä¸‹æ“ä½œ

```js
   // ç¼–è¾‘ä¸Šä¼ å¤´åƒ
    changeAvater () {
      // é€šè¿‡refè·å–ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶ - blobç±»å‹
      const file = this.$refs.file.files[0]
      // console.log(file)

      // å°†è·å–åˆ°çš„blobç±»å‹å›¾ç‰‡è½¬æ¢ä¸ºæ™®é€šå›¾ç‰‡çš„urlæ ¼å¼è·¯å¾„ - String
      this.img = window.URL.createObjectURL(file)
      console.log(this.img)
      // ä¸€å®šè¦æ¸…ç©ºinput
      this.$refs.file.value = ''

      // æ‰“å¼€ç¼–è¾‘å¤´åƒå¼¹æ¡†
      this.showAvatarBox = true
    }
```

3.å°†è·å–åˆ°çš„*img*å˜é‡ä¼ ç»™éœ€è¦åšå›¾ç‰‡è£å‰ªçš„ç»„ä»¶ä¸­çš„imgæ ‡ç­¾çš„srcå±æ€§åšåŠ¨æ€å±æ€§

```html
<img :src="img" ref="img" />
```

äºŒ. è£å‰ªä¸Šä¼ çš„å›¾ç‰‡éƒ¨åˆ†

1.ä¸‹è½½ä¾èµ–åŒ…ï¼š

```bash
npm install cropperjs
```

2.åœ¨å¯¹åº”åœ¨ç¼–è¾‘å¤´åƒä¸Šä¼ çš„ç»„ä»¶ä¸­å¼•å…¥jsã€cssï¼š

```js
import 'cropperjs/dist/cropper.css'
import Cropper from 'cropperjs'
```

3.åœ¨mountedä¸­åˆå§‹åŒ–cropper

```vue
data () {
  return {
    cropper: null
  }
},
mounted () {
    // é€šè¿‡refè·å–åŠ è½½å›¾ç‰‡çš„é¡µé¢å…ƒç´ 
    const image = this.$refs.img
    // å®ä¾‹åŒ–cropperï¼ˆä¹Ÿæ˜¯å¯¹ä¸Šä¼ çš„å›¾ç‰‡è¿›è¡Œè£å‰ªé…ç½®çš„è¿‡ç¨‹ï¼‰
    this.cropper = new Cropper(image, {
 	  // è£å‰ªå›¾ç‰‡é…ç½®é¡¹
      viewMode: 1, // å®šä¹‰è£å‰ªæ¨¡å¼ï¼Œ0ï¼šè£å‰ªæ¡†å¯ä»¥æ‰©å±•åˆ°ç”»å¸ƒå¤–ï¼Œ 1,2,3ä¼šå°†è£å‰ªæ¡†é™åˆ¶åœ¨ç”»å¸ƒå†…
      dragMode: 'move', // æ‹–åŠ¨æ¨¡å¼ move: ç§»åŠ¨ç”»å¸ƒ
      aspectRatio: 1, // æˆªå›¾æ¯”ä¾‹, 1:1å¯ä»¥ç®€å†™ä¸º1
      autoCropArea: 1, // è‡ªåŠ¨æˆªå›¾åŒº
      cropBoxMovable: false, // æˆªå›¾åŒºåŸŸæ˜¯å¦å¯ä»¥ç§»åŠ¨
      cropBoxResizable: false, // æˆªå›¾åŒºçš„ç¼©æ”¾åŠŸèƒ½
      background: false, // æ˜¯å¦æ˜¾ç¤ºé»˜è®¤èƒŒæ™¯
      movable: true // èƒŒæ™¯å›¾ç‰‡æ˜¯å¦å¯ä»¥ç§»åŠ¨ï¼Œé»˜è®¤true
      // crop (event) { // å½“ç§»åŠ¨å›¾ç‰‡æ˜¯ä¼šè¿”å›çš„å„ç§æ•°æ®ï¼ˆä»Šå¤©çš„æ¡ˆä¾‹ä¸­ä¸éœ€è¦ä½¿ç”¨ï¼‰
      //   console.log(event.detail.x)
      //   console.log(event.detail.y)
      //   console.log(event.detail.width)
      //   console.log(event.detail.height)
      //   console.log(event.detail.rotate)
      //   console.log(event.detail.scaleX)
      //   console.log(event.detail.scaleY)
      // }
    })
}

```

ä¸‰ã€å¤„ç†è£å‰ªåçš„å›¾ç‰‡çš„ä¸¤ç§æ–¹å¼

1.åç«¯å¤„ç†

å¦‚æœåŸºäºæœåŠ¡ç«¯è£å‰ªï¼Œåˆ™ä½¿ç”¨getDataæ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¯ä»¥å¾—åˆ°è£å‰ªåŒºåŸŸçš„å„å‚æ•°ï¼š

```
this.cropper.getData() // - å¾—åˆ°è£å‰ªåŒºåŸŸçš„å…¨éƒ¨ç›¸å…³æ•°æ®ï¼Œå°†è¯¥æ•°æ®ä¼ ç»™åç«¯ï¼Œåç«¯å…¨æƒå¤„ç†å›¾ç‰‡
```

2.å‰ç«¯å¤„ç†

```vue
methods: {
    success () {
      // å‘é€è¯·æ±‚ä¸Šä¼ å¤´åƒ
      // æ–¹æ³•2ï¼šå‰ç«¯è‡ªå·±åšè£å‰ªå·¥ä½œï¼Œé€šè¿‡cropperçš„å®ä¾‹æ–¹æ³•ï¼Œæ¥ç›´æ¥è·å–è£å‰ªåçš„å›¾ç‰‡ï¼ˆè·å–åˆ°çš„æ•°æ®æ˜¯blobç±»å‹ï¼‰
      this.cropper.getCroppedCanvas().toBlob(blob => {
        // blobå°±æ˜¯è£å‰ªåçš„å›¾ç‰‡ä¿¡æ¯ï¼Œæˆ‘ä»¬åªéœ€è¦å°†è¿™ä¸ªå›¾ç‰‡ä¿¡æ¯ä¼ ç»™åç«¯å³å¯

        // è°ƒç”¨ä¸Šä¼ å¤´åƒæ–¹æ³•
        this.updataUserPhoto(blob)
      })
    },

    // ä¸Šä¼ å¤´åƒå‡½æ•°
    async updataUserPhoto (blob) {
      // æç¤ºåŠ è½½çŠ¶æ€ï¼ˆåŠ è½½æœŸé—´ä¸èƒ½åšå…¶ä»–æ“ä½œï¼‰
      this.$toast.loading({
        message: 'å¤´åƒä¸Šä¼ ä¸­...',
        duration: 0,
        forbidClick: true // æ˜¯å¦ç¦ç”¨èƒŒæ™¯ä¸­çš„ç‚¹å‡»æ“ä½œ
      })
      try {
        // å¦‚æœä¼ ç»™åç«¯çš„æ•°æ®ç±»å‹æ˜¯ file é‚£ä¹ˆå°±å¿…é¡»è¦ç”¨FormDataä¼ é€’
        // å®ä¾‹åŒ–
        const formData = new FormData()
        // æ·»åŠ å›¾ç‰‡æ–‡ä»¶ï¼Œé”®åphotoæ˜¯åç«¯æ¥æ”¶è¯·æ±‚æ—¶è¦æˆ‘ä»¬ä¼ é€’çš„åå­—
        formData.append('photo', blob)
        // å‘é€è¯·æ±‚
        const { data: res } = await updataUserPhotoAPI(formData)

        // é€šçŸ¥çˆ¶ç»„ä»¶ä¸´æ—¶æ”¹å˜å¤´åƒ
        this.$emit('updataPhoto', res.data.photo)

        this.$toast.success('ä¸Šä¼ æˆåŠŸ')

        // å…³é—­å¤´åƒç¼–è¾‘æ¡†
        this.close()
      } catch (error) {
        console.log(error)
        this.$toast.fail('ä¸Šä¼ å¤±è´¥')
      }
    }
  }
```



## æ–‡ç« è¯¦æƒ…ä¸­çš„å¤šå¼ å›¾ç‰‡æµè§ˆåŠŸèƒ½ğŸ’¡

é…åˆvantç»„ä»¶ä¸­çš„*ImagePreview å›¾ç‰‡é¢„è§ˆ*æ¨¡å—å®ç°

1.è·å–ä¸€ç¯‡æ–‡ç« ä¸­çš„æ‰€æœ‰å›¾ç‰‡çš„srcå±æ€§å€¼

```
methods: {
    // è·å–æ–‡ç« è¯¦æƒ…
    async getArticle () {
      try {
        const res = await getArticlesByIdAPI(this.articleId)
        
        // å¤šå¼ å›¾ç‰‡é¢„è§ˆåŠŸèƒ½
        // è·å–æ‰€æœ‰æ–‡ç« è¯¦æƒ…ä¸­çš„æ‰€æœ‰çš„å›¾ç‰‡domå…ƒç´ ï¼Œéœ€è¦ä½¿ç”¨setTimeoutæ¥å»¶è¿Ÿè·å–
        setTimeout(() => {
          this.getArticleImg()
        }, 0)

        // èµ‹å€¼
        this.article = res.data.data
        // console.log(this.article)
      } catch (error) {
        console.log(error)
        // å±•ç¤º404é¡µé¢
        if (error.status === 404) {
          this.loadError = 404
        }
        this.$toast('åŠ è½½å¤±è´¥')
      }
      // åŠ è½½é¡µé¢å…³é—­
      this.loading = false
    },

    // è·å–æ–‡ç« dom
    getArticleImg () {

      const imgsDom = this.$refs.articleContent.querySelectorAll('img')
      //   console.log(imgsDom)

      // å°†imgsDomä¼ªæ•°ç»„è½¬æ¢æˆçœŸæ•°ç»„
      const imgsDomArr = [...imgsDom]

      // è·å–åˆ°æ¯å¼ å›¾ç‰‡ä¸­çš„srcåœ°å€ï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„
      const imgsSrc = imgsDomArr.map(item => item.src)
      //   console.log(imgsSrc)

      // ç»™æ¯ä¸ªimgç»‘å®šç‚¹å‡»äº‹ä»¶ï¼Œç‚¹å‡»åè¿›è¡Œé¢„è§ˆ
      imgsDomArr.forEach((item, i) => {
        item.onclick = () => {
          // ä½¿ç”¨vantç»„ä»¶è¿›è¡Œå›¾ç‰‡é¢„è§ˆå®ç°
          ImagePreview({
            images: imgsSrc,
            startPosition: i
          })
        }
      })
    }
  }
```



## å¼€å‘ç¯å¢ƒä¸‹è§£å†³è·¨åŸŸé—®é¢˜ğŸ’¡

1.ä¸ºä»€ä¹ˆä¼šå‡ºç°è·¨åŸŸï¼Ÿ

â€‹		å½“ä¸‹,æœ€æµè¡Œçš„å°±æ˜¯`å‰ååˆ†ç¦»`é¡¹ç›®,ä¹Ÿå°±æ˜¯`å‰ç«¯é¡¹ç›®`å’Œ`åç«¯æ¥å£`å¹¶ä¸åœ¨ä¸€ä¸ªåŸŸåä¹‹ä¸‹ï¼Œé‚£ä¹ˆå‰ç«¯é¡¹ç›®è®¿é—®åç«¯æ¥å£å¿…ç„¶å­˜åœ¨`è·¨åŸŸ`çš„è¡Œä¸ºï¼›

2.å¸¸ç”¨è§£å†³è·¨åŸŸçš„æ–¹å¼

 - æ–¹å¼1ï¼šjsonp

   â€‹		åŸç†ï¼šä¸æ˜¯é€šè¿‡ajaxè¯·æ±‚ï¼Œè€Œæ˜¯é€šè¿‡scriptæ ‡ç­¾å‘é€è¯·æ±‚ï¼›

   â€‹		ç¼ºç‚¹ï¼šåªèƒ½é€šè¿‡getæ–¹å¼å‘é€ï¼Œæ ¼å¼å•ä¸€ï¼Œå¹¶ä¸”æ•°æ®é‡å°ï¼Œå®‰å…¨æ€§ä½ï¼›

- æ–¹å¼2ï¼šCORS(cross origin sharing source)

  â€‹      åŸç†ï¼šåœ¨å“åº”å¤´ä¸­æ·»åŠ ` Access-Control-Allow-Origin `å±æ€§ï¼Œå¹¶ä¸”å®ƒçš„å€¼æ˜¯`* `æˆ–`è¯¥ç½‘é¡µå½“å‰çš„ç½‘å€` 

  â€‹      ç¼ºç‚¹ï¼šéœ€è¦åç«¯é…åˆï¼ŒIE9æµè§ˆå™¨ä¸æ”¯æŒè¯¥æ–¹æ³•çš„è·¨åŸŸï¼›

  â€‹      ä¼˜ç‚¹ï¼šå‰ç«¯ä¸éœ€è¦åšä»»ä½•æ”¹åŠ¨ï¼Œæ‰€æœ‰è¯·æ±‚æ–¹æ³•éƒ½æ”¯æŒï¼›

- æ–¹å¼3ï¼šæœåŠ¡å™¨ä»£ç†

â€‹      		åŸç†ï¼šåŸç†æ˜¯ æ‹¿å¦å¤–ä¸€å°æµè§ˆå™¨ä½œä¸ºæ¡¥æ¢ å…ˆè®¿é—®åˆ°æœ¬èº«åŒæºçš„æœåŠ¡å™¨ï¼Œæœ¬èº«çš„æœåŠ¡å™¨ å†é€šè¿‡å¦å¤–é‚£å°æœåŠ¡å™¨ è®¿é—®ä¸åŒæºçš„ç½‘é¡µæ‹¿åˆ°æ•°æ®ï¼Œè¿”å›ç»™æœ¬èº«çš„æœåŠ¡å™¨ï¼Œæœ¬èº«çš„æœåŠ¡å™¨å†è¿”å›ç»™éœ€è¦æ•°æ®çš„åŒæºç½‘é¡µï¼› 

â€‹     		 ç¼ºç‚¹ï¼šéœ€è¦å‰ç«¯æ­å»ºä»£ç†æœåŠ¡å™¨ï¼›

â€‹     		 ä¼˜ç‚¹ï¼šä¸éœ€è¦åç«¯é…åˆï¼›

- æ–¹å¼4ï¼šNginx åå‘ä»£ç†

åœ¨ **vueé¡¹ç›®ä¸­ï¼ˆå¼€å‘ç¯å¢ƒä¸­ï¼‰**ä¸»è¦è¿ç”¨`CORS`å’Œ`æœåŠ¡å™¨ä»£ç†`ä¸­åˆ©ç”¨*webpackçš„åå‘ä»£ç†*



é€šè¿‡é…ç½®vue-cliçš„ä»£ç†è§£å†³è·¨åŸŸè®¿é—®çš„é—®é¢˜

â€‹		å¼€å‘ç¯å¢ƒçš„è·¨åŸŸï¼Œä¹Ÿå°±æ˜¯åœ¨`vue-cliè„šæ‰‹æ¶ç¯å¢ƒ`ä¸‹å¼€å‘å¯åŠ¨æœåŠ¡æ—¶ï¼Œæˆ‘ä»¬è®¿é—®æ¥å£æ‰€é‡åˆ°çš„è·¨åŸŸé—®é¢˜ï¼Œvue-cliä¸ºæˆ‘ä»¬åœ¨æœ¬åœ°`å¼€å¯äº†ä¸€ä¸ªæœåŠ¡`,å¯ä»¥é€šè¿‡è¿™ä¸ªæœåŠ¡å¸®æˆ‘ä»¬`ä»£ç†è¯·æ±‚`,è§£å†³è·¨åŸŸé—®é¢˜

â€‹		è¿™å°±æ˜¯vue-clié…ç½®**webpackçš„åå‘ä»£ç†**

3.webpackçš„åå‘ä»£ç†æ­¥éª¤

â€‹		1.vue-cliçš„é…ç½®æ–‡ä»¶å³`vue.config.js`,è¿™é‡Œæœ‰æˆ‘ä»¬éœ€è¦çš„ [ä»£ç†é€‰é¡¹](https://cli.vuejs.org/zh/config/#devserver-proxy)ï¼Œæˆ‘ä»¬éœ€è¦åœ¨è¿™é‡Œé¢é…ç½®ä»£ç†é¡¹

```js
module.exports = {
  devServer: {
   // ä»£ç†é…ç½®é¡¹
    proxy: {
        // localhost:8888/api/abc  => vue-cliè„šæ‰‹æ¶å¯åŠ¨æœåŠ¡æ—¶ç»™æˆ‘ä»¬å¼€å¯çš„ä¸€ä¸ªæœ¬åœ°åç«¯æœåŠ¡å™¨
        // åå‘ä»£ç†åŸç†ï¼šæœ¬åœ°çš„å‰ç«¯æœåŠ¡å™¨ = å‘è¯·æ±‚ =ã€‹ æœ¬åœ°çš„åç«¯æœåŠ¡å™¨ =ã€‹ è¯·æ±‚ç›®æ ‡æœåŠ¡å™¨ä¸Šçš„æ•°æ®å†è¿”å›ç»™å‰ç«¯ï¼›
        // åå‘ä»£ç†æœ€ç»ˆurlè·¯å¾„= target + baseURL + æ¥å£urlè·¯å¾„
        '/api': { // è¿™é‡Œçš„api è¡¨ç¤ºå¦‚æœæˆ‘ä»¬åŸæ¥çš„çš„è¯·æ±‚åœ°å€ä¸­å«æœ‰â€˜/apiâ€™çš„æ—¶å€™,å°±ä¼šå‡ºè§¦å‘vue-cliçš„ä»£ç†æœºåˆ¶ï¼Œçœ‹å…·ä½“é¡¹ç›®urlè¿›è¡Œä¹¦å†™ï¼Œä¹Ÿå¯ä»¥æ˜¯/ascè¿™æ · =ã€‹å’ŒbaseURLä¸€è‡´å°±å¥½äº†
        target: 'http://ihrm.itheima.net', // è·¨åŸŸè¯·æ±‚æ•°æ®çš„ç›®æ ‡åœ°å€
        changeOrigin: true, // æ˜¯å¦è·¨åŸŸ éœ€è¦è®¾ç½®æ­¤å€¼ä¸ºtrue æ‰å¯ä»¥è®© æœ¬åœ°åç«¯æœåŠ¡å™¨ ä»£ç†æˆ‘ä»¬ å‰ç«¯æœåŠ¡å™¨ å‘å‡ºè¯·æ±‚ï¼›
         // è·¯å¾„é‡å†™(å¯ä»¥ä¸è¿›è¡Œè·¯å¾„é‡æ–°)
        pathRewrite: {
            // é‡æ–°è·¯ç”± 
            // ç›®æ ‡ï¼šå°†localhost:8888/api/login å˜ä¸º => http://ihrm.itheima.net/login
            '^/api': '' // å‡è®¾æˆ‘ä»¬æƒ³æŠŠ localhost:8888/api/login å˜æˆhttp://ihrm.itheima.net/login å°±éœ€è¦è¿™ä¹ˆåš 
        }
      },
    }
  }
}
```

å½“è¿›è¡Œä»¥ä¸Šé…ç½®æ—¶ï¼Œåœ¨*request.js*æ–‡ä»¶ä¸­è¯·æ±‚æ ¹è·¯å¾„çš„ä¹¦å†™å¦‚ä¸‹ï¼š

```js
const request = axios.create({
  // baseURL: 'http://ihrm.itheima.net/prod-api' // å·²ç»è¿›è¡Œä»£ç†è¿‡åçš„åœ°å€èƒ½ç›´æ¥ä½¿ç”¨
  // æ–¹å¼1ï¼šä¸é‡å†™è·¯å¾„ï¼Œè¿™æ˜¯proxyçš„å…³é”®å­—ä¸º'/prod-api'
  // baseURL: '/prod-api'
  // æ–¹å¼2ï¼šé‡å†™è·¯å¾„
  baseURL: '/api'
})
```



## ç™»å½•æµç¨‹çš„å®ç°ğŸ’¡

1.é¦–å…ˆæ ¹æ®uiå›¾ç”»å¥½å¯¹åº”çš„ç™»å½•ç•Œé¢ï¼Œç„¶åæ ¹æ®éœ€æ±‚å¯¹ç”¨æˆ·è´¦å·å’Œå¯†ç è¿›è¡Œè¡¨å•æ ¡éªŒï¼›

2.ç„¶åè°ƒå–å¯¹åº”çš„ç™»å½•APIæ¥å£å°†è¡¨å•çš„ä¿¡æ¯æ”¶é›†å‘é€ç»™åç«¯ï¼›

3.å› ä¸ºç™»å½•è¯·æ±‚æˆåŠŸåï¼Œåç«¯ä¼šè¿”å›ä¸€ä¸ªç”¨æˆ·tokenï¼Œä¸ºäº†ä¹‹åçš„ä¸šåŠ¡ä¸­èƒ½å¤Ÿæ›´æ–¹ä¾¿çš„ä½¿ç”¨è°ƒå–tokenï¼Œå°±ä¼šå°†tokenå­˜æ”¾åˆ°vuexå’Œcookieå½“ä¸­ï¼›

4.è€Œè·å–tokenè¿™æ­¥æ“ä½œæ˜¯å¼‚æ­¥çš„ï¼Œæ‰€ä»¥æˆ‘æ˜¯åœ¨vuexå¯¹åº”çš„ç”¨æˆ·æ¨¡å—é‡Œé¢çš„actionsä¸­å»å°è£…ä¸€ä¸ªè°ƒç”¨ç™»å½•æ¥å£çš„æ–¹æ³•æ¥è¿›è¡Œç™»å½•è¯·æ±‚ï¼Œç­‰ç™»å½•è¿”å›æˆåŠŸåï¼Œå†è°ƒå–mutationsé‡Œé¢çš„æ–¹æ³•å¯¹tokenè¿›è¡Œå­˜å‚¨ä»¥åŠæŒä¹…åŒ–ï¼›

5.å› ä¸ºå¾ˆå¤šåŠŸèƒ½å‘é€è¯·æ±‚çš„æ—¶å€™éƒ½ä¼šéœ€è¦åœ¨è¯·æ±‚å¤´é‡Œé¢åŠ ä¸Štokençš„æƒé™ï¼Œæ‰€ä»¥æˆ‘ä¹Ÿåœ¨è¯·æ±‚æ‹¦æˆªå™¨é‡Œé¢ç»™headersåŠ ä¸Štokenï¼›

6.æœ€åè®©è·¯ç”±è·³è½¬åˆ°é¦–é¡µå»ï¼›

7.å› ä¸ºtokenä¼šè¿‡æœŸï¼Œæ‰€ä»¥å½“tokenè¿‡æœŸçš„æ—¶å€™æˆ‘ä»¬éœ€è¦è®©é¡µé¢è·³å›ç™»é™†é¡µé¢è¿›è¡Œé‡æ–°ç™»å½•ï¼Œæ‰€ä»¥æˆ‘åˆåœ¨å“åº”æ‹¦æˆªå™¨é‡Œé¢é€šè¿‡responseçš„statusåˆ¤æ–­çŠ¶æ€ç æ˜¯å¦ä¸º401ï¼Œå¦‚æœæ˜¯ï¼Œå°±è¯æ˜tokenè¿‡æœŸäº†ï¼Œç„¶åå°±æ¸…ç©ºtokenï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢ï¼›

![](images/ç™»å½•åœºæ™¯æµç¨‹å›¾.jpg)





## æ ¹æ®ä¸åŒçš„çŠ¶æ€å±•ç¤ºä¸åŒçš„æ•°æ®ğŸ’¡

  > æ€»ç»“è®ºï¼š
  >
  > 1. åªè¦æ˜¯åšåˆ—è¡¨æ•°æ®çš„ä¸åŒçŠ¶æ€çš„ç­›é€‰æ—¶ï¼Œ ä¸€å®šæœ‰ä¸¤æ¡æ•°æ®ç»“æ„ï¼ˆ1. æºæ•°æ® 2. å±•ç¤ºæ•°æ®ï¼‰;
  > 2. ä¸åŒçš„çŠ¶æ€éœ€è¦æœ‰ä¸€ä¸ªçŠ¶æ€å˜é‡æ¥æ§åˆ¶ï¼Œè¿™ä¸ªå˜é‡å½“å‰çš„çŠ¶æ€å½±å“ç€å±•ç¤ºæ•°æ®çš„å†…å®¹;
  >
  > é¡µé¢æ ·å¼ï¼š
  >
  > 1. åœ¨æ§åˆ¶å±•ç¤ºæ•°æ®çš„ç»„ä»¶ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªçŠ¶æ€å˜é‡ï¼Œè¡¨æ˜è¯¥å˜é‡æœ‰ç€æ€æ ·çš„èµ‹å€¼è§„åˆ™ ï¼ˆæˆ–ç”¨æ•°å­—æ¥è¡¨ç¤ºçŠ¶æ€ï¼Œ ç”¨è‹±æ–‡å•è¯æ¥è¡¨ç¤ºçŠ¶æ€ï¼‰ï¼Œå¿…é¡»è¦åœ¨è¯¥å˜é‡çš„åé¢å†™ä¸Šè¯´æ˜;
  > 2. é€šè¿‡å½“å‰è®¾ç½®çš„å˜é‡ï¼Œç»™é¡µé¢ä¸­çš„å„ä¸ªæ ‡ç­¾è®¾ç½®åŠ¨æ€æ ·å¼ï¼ˆé€šè¿‡è®¾ç½®çš„å˜é‡æ¥åˆ¤æ–­trueè¿˜æ˜¯falseï¼‰;
  > 3. é€šè¿‡ç»‘å®šç‚¹å‡»äº‹ä»¶(æˆ–å…¶ä»–äº‹ä»¶)ï¼Œå¯¹ä¸åŒçš„åˆ‡æ¢æŒ‰é’®è®¾ç½®æ”¹å˜å½“å‰çŠ¶æ€å˜é‡çš„é€»è¾‘(åˆ†åˆ«æ•°æ®åœ¨å“ªé‡Œ)ï¼›
  >
  > æ•°æ®å¤„ç†
  >
  > 1. åˆ†è¾¨æ•°æ®åœ¨å“ªå¤„ç†ï¼Œåœ¨çˆ¶ç»„ä»¶ä¸­åšæ•°æ®å¤„ç†ï¼Œéœ€è¦å­ç»„ä»¶é€šçŸ¥çˆ¶ç»„ä»¶ï¼ˆé€šè¿‡è‡ªå®šä¹‰äº‹ä»¶ï¼‰ï¼›
  >
  > 2. çˆ¶ç»„ä»¶ä¸­éœ€è¦è·å–åˆ°å½“å‰å±•ç¤ºçš„çŠ¶æ€å€¼ï¼Œæ¥ç”Ÿæˆå±•ç¤ºçš„åˆ—è¡¨æ•°æ® - çŠ¶æ€å˜åŒ–å¯¼è‡´å±•ç¤ºæ•°æ®å˜åŒ– ï¼š
  >     è®¡ç®—å±æ€§ä¸­çš„ä¾èµ–é¡¹å°±æ˜¯è¿™ä¸ªçŠ¶æ€å€¼
  >             	      è®¡ç®—å±æ€§çš„è¿”å›å€¼å°±æ˜¯å±•ç¤ºçš„åˆ—è¡¨æ•°æ®
  >
  > 3. å°†è®¡ç®—å±æ€§è¿”å›çš„å±•ç¤ºæ•°æ®ï¼Œä¼ ç»™å…¶ä»–çš„å­ç»„ä»¶ï¼›
  >
  >    (è¯¥åŒºåŸŸæ ·å¼ï¼šåŒç©ºæ ¼ + > + æŒ‰enter)





## åŠ è½½å›¾ç‰‡èµ„æºå‡ºé”™æ—¶çš„å¤„ç†æ–¹å¼ğŸ’¡

åŸç†ï¼šå½“è¯·æ±‚å›¾ç‰‡èµ„æºæ‰¾ä¸åˆ°æ—¶ï¼Œæˆ‘ä»¬é»˜è®¤ç»™ä¸€å¼ å›¾ç‰‡ï¼›

â€‹		æ–¹å¼1ï¼šé€šè¿‡äº‹ä»¶ç›‘å¬ =ã€‹*error* äº‹ä»¶ç›‘å¬å›¾ç‰‡æ˜¯å¦å‡ºé”™ï¼Œå‡ºé”™æ—¶ç»“åˆ *ref* è·å–å›¾ç‰‡å…ƒç´ ï¼Œç»™å…¶srcå±æ€§æ·»åŠ ä¸€å¼ é»˜è®¤çš„å›¾ç‰‡ï¼›

â€‹		æ–¹å¼2ï¼šæ³¨å†Œè‡ªå®šä¹‰æŒ‡ä»¤



## æ‰å¹³æ•°ç»„è½¬æ ‘å½¢ç»“æ„æ•°ç»„ğŸ’¡

åœ¨src/utils/index.jsä¸­å±æ€§è¯¥æ–¹æ³•ï¼š

```js
/**
 * æ‰å¹³åŒ–æ•°ç»„è½¬ä¸ºæ ‘å½¢ç»“æ„ => ç”¨é€’å½’ç®—æ³•
 *
 * @params list éœ€è¦è½¬æ¢çš„æ•°ç»„
 * @params rootValue ä¸¤ä¸ªå…ƒç´ æ˜¯å¦æœ‰å­çˆ¶å…³ç³»çš„åˆ¤æ–­æ¡ä»¶
 */

// éå†listè¿™ä¸ªæ‰å¹³æ•°ç»„ï¼Œæ ¹æ®é¡¹ç›®ä¸­è¿”å›çš„æ•°æ®å‘ç°ï¼Œ
//    å½“æ•°æ®ä¸­aå…ƒç´ çš„idç­‰äºbå…ƒç´ çš„pidæ—¶ï¼Œè¯´æ˜aå…ƒç´ æ˜¯bå…ƒç´ çš„çˆ¶å…ƒç´ ï¼Œæ‰€ä»¥éå†çš„æ—¶å€™æ ¹æ®è¿™ä¸ªè§„åˆ™è¿›è¡Œåˆ¤æ–­
//    ä¸”æ ¹èŠ‚ç‚¹çš„ pidä¸º '' ;
export const tranListToTreeData = (list, rootValue) => { // rootValueæ˜¯æ¯ä¸ªå…ƒç´ çš„id
  // ç”³æ˜ä¸€ä¸ªæ•°ç»„æ¥è¿›è¡Œæ¥æ”¶æ–°æ•°ç»„
  const arr = []
  // éå†æ•°ç»„
  list.forEach(item => {
    // åˆ¤æ–­æ˜¯å¦æ˜¯æ ¹èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯ï¼Œå°±ç»§ç»­å‘ä¸‹æ‰¾å…¶æœ‰æ²¡æœ‰å­èŠ‚ç‚¹ï¼ˆæ ¹æ®å…¶idæ˜¯å¦ç­‰äºä¸‹æ¬¡å¾ªç¯çš„itemçš„pidï¼‰
    if (item.pid === rootValue) {
      // item.pid === rootValueï¼Œå†å»å¾ªç¯listï¼Œå¯»æ‰¾æ˜¯å¦æœ‰å…ƒç´ çš„pidæ˜¯å¦ç­‰äºå…¶(item)çš„id
      const children = tranListToTreeData(list, item.id)
      // å½“éå†ååˆ¤æ–­childrençš„æ•°ç»„æ˜¯å¦æœ‰é•¿åº¦ï¼Œæœ‰çš„è¯å°±è¡¨æ˜itemæœ‰å­èŠ‚ç‚¹ï¼Œå°±è®©item.childrenç­‰äºè¿™ä¸ªæ‰¾åˆ°çš„æ•°ç»„children
      if (children.length > 0) {
        item.children = children
      }
      // å°†itemæ·»åŠ åˆ°æ–°æ•°ç»„ä¸­å»
      arr.push(item)
    }
    // è¿”å›è¿™ä¸ªæ•°ç»„
    return arr
  })
```



## æ³¨å†Œå…¨å±€ç»„ä»¶ğŸ’¡

åº”ç”¨åœºæ™¯ï¼šå½“ä¸€äº›ç›¸åŒæˆ–ç›¸ä¼¼ç»„ä»¶åœ¨å¤šä¸ªé¡µé¢éƒ½ä¼šè¢«ç”¨åˆ°æ—¶ï¼Œä¸€èˆ¬å°±ä¼šè¿›è¡Œå…¨å±€ç»„ä»¶å°è£…ä½¿ç”¨ï¼Œè¿™ç±»ç»„ä»¶ä¸€èˆ¬ä¼šé…åˆä½œç”¨åŸŸæ’æ§½ä½¿ç”¨ï¼›

æ­¥éª¤ï¼š

1.å…ˆåœ¨*src/components*é‡Œé¢å»ºç«‹å¯¹åº”çš„ä¸€ç±»æ–‡ä»¶å¤¹ï¼Œå†åœ¨è¯¥æ–‡ä»¶å¤¹é‡Œé¢å»ºç«‹è¯¥ç»„ä»¶çš„vueæ–‡ä»¶ï¼›

2.åœ¨*src/components*é‡Œé¢å»ºç«‹*index.js*è¿›è¡Œç»„ä»¶ç»Ÿä¸€å¯¼å…¥å’Œå¯¼å‡º

```js
// å…¨å±€ç»Ÿä¸€æ³¨å†Œé€šç”¨ç»„ä»¶

// 1. å¼•å…¥ç»„ä»¶
import PageTools from '@/components/PageTools/index.vue'
import UploadExcel from './UploadExcel/index.vue'

// 2. é»˜è®¤å¯¼å‡ºï¼Œä½¿ç”¨install()æ–¹æ³•
export default {
  install(Vue) {
    Vue.component('PageTools', PageTools)
    Vue.component('UploadExcel', UploadExcel)
  }
}
```

3.åœ¨*src/main.js*ä¸­ç»Ÿä¸€å¼•è¿›åŠæ³¨å†Œ

```js
import Components from './components/index.js' // å¼•å…¥å…¨å±€æ³¨å†Œçš„é€šç”¨ç»„ä»¶
Vue.use(Components) // æ³¨å†Œå…¨å±€ç»„ä»¶
```

4.åœ¨ç»„ä»¶ä¸­ç›´æ¥ä½¿ç”¨å³å¯ï¼ˆä¸ç”¨å•ç‹¬å¼•å…¥åŠæ³¨å†Œï¼‰



## åŠ¨æ€è·¯ç”±ğŸ’¡

åŠ¨æ€è·¯ç”±ä¸é™æ€è·¯ç”±ï¼šé™æ€è·¯ç”±ç»„ä»¶å°±æ˜¯æ‰€æœ‰äººéƒ½èƒ½çœ‹åˆ°çš„ï¼Œå¯¹åº”çš„åŠ¨æ€è·¯ç”±å°±æ˜¯åªæœ‰*æœ‰æƒé™*çš„ç”¨æˆ·æ‰èƒ½çœ‹åˆ°ï¼›

æ­¥éª¤ï¼š

1.åœ¨*src/router/modules*ä¸‹é¢å»ºç«‹å¯¹åº”åŠ¨æ€è·¯ç”±æ–‡ä»¶,å¦‚ï¼š*src/router/modules/employees*

```js
// å¯¼å‡ºå‘˜å·¥è§„åˆ™
import Layout from '@/layout/index.vue' //å¸ƒå±€é¡µé¢
export default {
  // è·¯ç”±è§„åˆ™
  path: '/employees',
  name: 'employees',
  component: Layout,
  children: [
    {
      // äºŒçº§è·¯ç”±çš„pathä¸ºç©ºæ—¶è¡¨ç¤ºäºŒçº§è·¯ç”±çš„é»˜è®¤è·¯ç”±,è·³è½¬åˆ°ä¸€çº§è·¯ç”±çš„æ—¶å€™ä¼šæ˜¾ç¤ºè¿™ä¸ªé»˜è®¤è·¯ç”±
      path: '', // è¡¨ç¤ºä¸ä»…æœ‰/employeesï¼Œä¹Ÿæœ‰å‘˜å·¥ç®¡ç†é¡µé¢
      component: () => import('@/views/employees/index.vue'),
      // metaä¸ºè·¯ç”±å…ƒä¿¡æ¯ï¼Œå°±æ˜¯ä¸€ä¸ªå‚¨å­˜æ•°æ®çš„åœ°æ–¹ï¼Œ å¯ä»¥æ”¾ä»»ä½•å†…å®¹
      meta: {
        title: 'å‘˜å·¥ç®¡ç†', icon: 'people'
      }
    },
    {
      path: 'detail/:id',
      component: () => import('@/views/employees/detail.vue'),
      hidden: true
    }
  ]
}

```

2.åœ¨*src/router/index.js*ä¸­å¼•å…¥ã€æ³¨å†Œ

```js
import employeesRouter from './modules/employees' // å¼•å…¥
// ç”³æ˜ä¸€ä¸ªåŠ¨æ€è·¯ç”±å˜é‡
export const asyncRoutes = [
  employeesRouter
]

const createRouter = () => new Router({
  // mode: 'history', // require service support
  scrollBehavior: () => ({ y: 0 }),
  // å…ˆå°†åŠ¨æ€è·¯ç”±å’Œé™æ€è·¯ç”±éƒ½åˆå¹¶å±•ç¤ºåœ¨é¡µé¢ä¸­ï¼Œå½“åšåˆ°æƒé™ç®¡ç†çš„æ—¶å€™æ‰è¿›è¡ŒåŠ¨æ€è·¯ç”±å’Œé™æ€è·¯ç”±çš„åˆ†ç¦»
  routes: [...constantRoutes, ...asyncRoutes]
})

const router = createRouter()

export function resetRouter() {
  const newRouter = createRouter()
  router.matcher = newRouter.matcher // reset router
}

export default router
```



## æ³¨å†Œå…¨å±€è‡ªå®šä¹‰æŒ‡ä»¤ğŸ’¡

åº”ç”¨ï¼šä¸€äº›é‡å¤ç”¨åˆ°çš„åŠŸèƒ½ä»£ç å°±å¯ä»¥å°è£…æˆå…¨å±€è‡ªå®šä¹‰æŒ‡ä»¤ï¼Œå¦‚è¯·æ±‚å›¾ç‰‡èµ„æºï¼Œåç«¯å›¾ç‰‡å‡ºé”™ä¸èƒ½è¯·æ±‚åˆ°æ—¶ï¼›

æ­¥éª¤ï¼š

1.åœ¨*src/directives/index.js*ä¸­è¿›è¡Œå°è£…æ‰€éœ€çš„è‡ªå®šä¹‰æŒ‡ä»¤ï¼š

```js
// æ‰€æœ‰çš„è‡ªå®šä¹‰æŒ‡ä»¤éƒ½å­˜æ”¾åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­

export const imgerror = {
  // elæ˜¯ç»‘å®šè‡ªå®šä¹‰æŒ‡ä»¤çš„å…ƒç´ ï¼Œbindingæ˜¯ä½¿ç”¨æŒ‡ä»¤æ˜¯ä¼ è¿‡æ¥çš„å‚æ•°å¯¹è±¡ï¼Œå…¶ä¸­çš„valueå€¼å°±æ˜¯ä¼ è¿‡æ¥çš„å‚æ•°
  inserted(el, binding) {
    // errorä¸ºå‡ºé”™æ—¶è§¦å‘çš„äº‹ä»¶
    el.onerror = function() {
      el.src = binding.value
    }
  }
}
```

2.åœ¨*main.js*ä¸­è¿›è¡Œå…¨éƒ¨å¼•å…¥åŠæ³¨å†Œï¼š

```js
// å¼•å…¥æ‰€æœ‰è‡ªå®šä¹‰æŒ‡ä»¤çš„å¯¹è±¡ => directivesæ˜¯ä¸€ä¸ªå¯¹è±¡
import * as directives from '@/directives/index.js'

// ç”¨Object.kes() è·å–è¿™ä¸ªå¯¹è±¡çš„é”®åä½œä¸ºè‡ªå®šä¹‰å±æ€§åï¼ŒObject.kes()è¿”å›çš„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼›ç„¶åå†ç”¨forEach()éå†è¿™ä¸ªæ•°ç»„è¿›è¡ŒæŒ‡ä»¤å…¨å±€æ³¨å†Œ
// å…¨å±€æ³¨å†Œè‡ªå®šä¹‰æŒ‡ä»¤çš„è¯­æ³•ï¼š
// Vue.directive(è‡ªå®šä¹‰æŒ‡ä»¤å, æŒ‡ä»¤æ‰§è¡Œçš„é€»è¾‘->å¯¹è±¡)
Object.keys(directives).forEach(key => {
  Vue.directive(key, directives[key])
})
```

3.åœ¨ç»„ä»¶ä¸­è¿›è¡Œä½¿ç”¨

```vue
<img v-imageerror="defaultImg" :src="staffPhoto" class="user-avatar">

 data() {
    return {
      defaultImg: require('@/./assets/common/head.jpg') //ä¼ ä¸€ä¸ªé»˜è®¤å›¾ç‰‡è·¯å¾„
    }
  },
```



## å…¨å±€è¿‡æ»¤å™¨çš„ä½¿ç”¨ğŸ’¡

åº”ç”¨ï¼šå¤šä¸ªåœ°æ–¹éœ€è¦å¯¹åŒä¸€ç§æ•°æ®æ ¼å¼è¿›è¡Œç›¸åŒçš„æ ¼å¼åŒ–å¤„ç†çš„æ—¶å€™å°±å¯ä»¥æ³¨å†Œå…¨å±€è¿‡æ»¤å™¨ï¼Œå¦‚å¯¹æ—¶é—´è¿›è¡Œç»Ÿä¸€æ ¼å¼å¤„ç†ï¼›

æ­¥éª¤ï¼š

1.åœ¨*src/filters/index.js*ä¸­è¿›è¡Œå°è£…æ‰€éœ€çš„è¿‡æ»¤å™¨ï¼š

```js
// è¿‡æ»¤å™¨æ–‡ä»¶ => åœ¨main.jsä¸­æ‰¹é‡å¯¼å…¥

// æ—¶é—´è¿‡æ»¤å™¨,ç»“åˆmomentæ’ä»¶è¿›è¡Œæ—¶é—´æ ¼å¼å¤„ç†
import moment from 'moment'
export function formatDate(val) {
  if (val) {
    return moment(val).format('YYYY-MM-DD')
  } else {
    val
  }
}
```

2.åœ¨*main.js*ä¸­è¿›è¡Œå…¨éƒ¨å¼•å…¥åŠæ³¨å†Œï¼š

```js
// æ‰¹é‡å¯¼å…¥æ‰€æœ‰è¿‡æ»¤å™¨
import * as filters from '@/filters/index.js'

// æ‰¹é‡è¿›è¡Œå…¨å±€æ³¨å†Œ
Object.keys(filters).forEach(key => Vue.filter(key, filters[key]))
```

3.åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ï¼šç›´æ¥ä½¿ç”¨

   åœ¨ç»„ä»¶çš„jsä¸­ä½¿ç”¨è¿˜æ˜¯è¦å…ˆå¯¼å…¥å†ä½¿ç”¨

```
import { formatDate, formatEmployment } from '@/filters'

formatDate(æ ¼å¼åŒ–ä¹‹å‰çš„æ—¶é—´æ•°æ®)
```



## Excelæ–‡ä»¶çš„å¯¼å…¥å’Œå¯¼å‡ºğŸ’¡

å¯¼å…¥ï¼šå…±ä¸‰ä¸ªæ­¥éª¤

â€‹		æ­¥éª¤1ï¼šå®‰è£…xlsxåŒ…ï¼š`$ npm i xlsx`ï¼›

â€‹		æ­¥éª¤2ï¼šé€šè¿‡vue-element-adminå•ç‹¬ç”Ÿæˆä¸€ä¸ªä¸Šä¼ è¡¨æ ¼çš„åŠŸèƒ½ç»„ä»¶ï¼›è·¯ç”±ã€å…¨å±€å¼•å…¥ç»„ä»¶æ­¥éª¤çœç•¥ï¼Œçœ‹éœ€æ±‚è€Œå®šï¼Œè¿™é‡Œä¸»è¦æ˜¯å±•ç¤ºæ€æ ·å®ç°å¯¼å…¥åŠŸèƒ½ï¼›

â€‹		ä»¥ä¸‹ç»„ä»¶å°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„ä¸Šä¼ è¡¨æ ¼ã€è§£æè¡¨æ ¼å†…å®¹çš„ç»„ä»¶ï¼Œå½“éœ€è¦ç”¨åˆ°æ—¶åªç”¨å¼•å…¥è¯¥ç»„ä»¶ï¼Œç„¶åä½¿ç”¨è¯¥ç»„ä»¶çš„*onSuccess()*æ–¹æ³•å³å¯ï¼›

```vue
<template>
  <div class="upload-excel">
    <div class="btn-upload">
      <!-- æ­¥éª¤1ï¼šç‚¹å‡»ä¸Šä¼ æŒ‰é’®è§¦å‘inputæ¡†çš„ä¸»åŠ¨ç‚¹å‡»äº‹ä»¶click()-é€šè¿‡handleUploadå‡½æ•° -->
      <el-button :loading="loading" size="mini" type="primary" @click="handleUpload">
        ç‚¹å‡»ä¸Šä¼ 
      </el-button>
    </div>
    <!-- ä¸Šä¼ æ–‡ä»¶çš„inputæ¡† -->
    <!-- æ­¥éª¤2ï¼šaccept=".xlsx, .xls" æ˜¯è§„å®šä¸Šä¼ çš„æ–‡ä»¶ç±»å‹ï¼›é€šè¿‡*change*äº‹ä»¶æ¥è¿›è¡Œä¸Šä¼  -->
    <input ref="excel-upload-input" class="excel-upload-input" type="file" accept=".xlsx, .xls" @change="handleClick">

    <div class="drop" @drop="handleDrop" @dragover="handleDragover" @dragenter="handleDragover">
      <i class="el-icon-upload" />
      <span>å°†æ–‡ä»¶æ‹–åˆ°æ­¤å¤„</span>
    </div>
  </div>
</template>

<script>
import XLSX from 'xlsx'

export default {
  props: {
    beforeUpload: Function, // eslint-disable-line
    onSuccess: Function// eslint-disable-line
  },
  data() {
    return {
      loading: false,
      excelData: {
        header: null,
        results: null
      }
    }
  },
  methods: {
    // å°†å¤„ç†å¥½çš„è¡¨å¤´å’Œè¡¨ä½“æ•°æ®èµ‹å€¼å¹¶è°ƒç”¨onSuccess()å‡½æ•°
    generateData({ header, results }) {
      this.excelData.header = header
      this.excelData.results = results
      // this.$emit('on-success',this.excelData)
      // onSuccess()åœ¨å…¶ä»–ç»„ä»¶å¼•ç”¨è¯¥ç»„ä»¶æ—¶ä½¿ç”¨ï¼Œä¼šä¼ å‡ºä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åŒ…å«è¡¨å¤´å’Œè¡¨ä½“è§£æå¥½çš„ä¸¤ä¸ªæ•°ç»„
      this.onSuccess && this.onSuccess(this.excelData)
    },

    // æ‹–æ‹½æ–‡ä»¶ä¸Šä¼ çš„å‡½æ•°
    handleDrop(e) {
      e.stopPropagation()
      e.preventDefault()
      if (this.loading) return
      const files = e.dataTransfer.files
      if (files.length !== 1) {
        this.$message.error('Only support uploading one file!')
        return
      }
      const rawFile = files[0] // only use files[0]

      if (!this.isExcel(rawFile)) {
        this.$message.error('Only supports upload .xlsx, .xls, .csv suffix files')
        return false
      }
      this.upload(rawFile)
      e.stopPropagation()
      e.preventDefault()
    },
    // æ‹–æ‹½æ–‡ä»¶ä¸Šä¼ çš„å‡½æ•°
    handleDragover(e) {
      e.stopPropagation()
      e.preventDefault()
      e.dataTransfer.dropEffect = 'copy'
    },

    // æ­¥éª¤1ï¼šç‚¹å‡»ä¸Šä¼ æŒ‰é’®ï¼Œä¸»åŠ¨è§¦å‘ç‚¹å‡»éšè—çš„inputæ¡†ï¼Œé€šè¿‡$refsæ¥è·å–Inputæ¡†
    handleUpload() {
      this.$refs['excel-upload-input'].click()
    },

    // æ­¥éª¤2ï¼šé€šè¿‡inputæ¡†çš„changeäº‹ä»¶æ¥è¿›è¡Œä¸Šä¼ æ–‡ä»¶çš„è·å–ä»¥åŠè°ƒç”¨ä¸Šä¼ çš„upload()å‡½æ•°
    handleClick(e) {
      // inputæ¡†è·å–æ–‡ä»¶é€šè¿‡äº‹ä»¶å¯¹è±¡e,å†é€šè¿‡ä»¥ä¸‹ä¸¤æ­¥è·å–åˆ°æ­£çœŸçš„æ–‡ä»¶
      const files = e.target.files
      const rawFile = files[0] // only use files[0]
      // éç©ºåˆ¤æ–­
      if (!rawFile) return
      // è°ƒç”¨æ­£çœŸä¸Šä¼ æ–‡ä»¶çš„å‡½æ•°ï¼Œå°†è·å–åˆ°çš„æ–‡ä»¶å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ è¿‡å»
      this.upload(rawFile)
    },

    // æ­¥éª¤3ï¼šä¸Šä¼ æ–‡ä»¶å‡½æ•°
    upload(rawFile) {
      this.$refs['excel-upload-input'].value = null // fix can't select the same excel

      if (!this.beforeUpload) {
        this.readerData(rawFile) // è°ƒç”¨è¯»å–æ–‡ä»¶å†…å®¹çš„å‡½æ•°
        return
      }
      const before = this.beforeUpload(rawFile)
      if (before) {
        this.readerData(rawFile)
      }
    },

    // è¯»å–ä¸Šä¼ æ–‡ä»¶å†…å®¹çš„å‡½æ•°
    readerData(rawFile) {
      this.loading = true
      return new Promise((resolve, reject) => {
        const reader = new FileReader() // JSåŸå§‹è¯»å–æ–‡ä»¶çš„æ„é€ å‡½æ•°
        reader.onload = e => {
          const data = e.target.result
          const workbook = XLSX.read(data, { type: 'array' }) // ä½¿ç”¨å®‰è£…çš„xlsxæ’ä»¶å¯¹æ•°æ®è¿›è¡Œè§£æï¼Œå¹¶è§£ææˆæ•°ç»„ï¼ˆtype: 'array'ï¼‰
          const firstSheetName = workbook.SheetNames[0]
          const worksheet = workbook.Sheets[firstSheetName]
          const header = this.getHeaderRow(worksheet) // è¯»å–è¡¨å¤´å†…å®¹
          // å°†æ•´å¼ è¡¨æ ¼çš„å†…å®¹è¯»å–æˆæ•°ç»„ï¼Œæ¯è¡Œè¡¨æ ¼å°±æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å†ä½œä¸ºæ•°ç»„çš„æ¯ä¸ªå…ƒç´ ï¼Œæ¯åˆ—çš„è¡¨å¤´ä½œä¸ºå¯¹è±¡çš„keyï¼Œå†…å®¹ä½œä¸ºvalue
          const results = XLSX.utils.sheet_to_json(worksheet)
          this.generateData({ header, results }) // å°†å¤„ç†å¥½çš„è¡¨å¤´å’Œè¡¨ä½“æ•°æ®ä¼ ç»™generateData()è¿›è¡Œèµ‹å€¼ä»¥åŠè°ƒç”¨onSuccess()å‡½æ•°
          this.loading = false
          resolve()
        }
        reader.readAsArrayBuffer(rawFile)
      })
    },
    // è¯»å–è¡¨å¤´
    getHeaderRow(sheet) {
      const headers = []
      const range = XLSX.utils.decode_range(sheet['!ref'])
      let C
      const R = range.s.r
      /* start in the first row */
      for (C = range.s.c; C <= range.e.c; ++C) { /* walk every column in the range */
        const cell = sheet[XLSX.utils.encode_cell({ c: C, r: R })]
        /* find the cell in the first row */
        let hdr = 'UNKNOWN ' + C // <-- replace with your desired default
        if (cell && cell.t) hdr = XLSX.utils.format_cell(cell)
        headers.push(hdr)
      }
      return headers
    },
    isExcel(file) {
      return /\.(xlsx|xls|csv)$/.test(file.name)
    }
  }
}
</script>

<style scoped lang="scss">
.upload-excel {
  display: flex;
  justify-content: center;
   margin-top: 100px;
   .excel-upload-input{
       display: none;
        z-index: -9999;
     }
   .btn-upload , .drop{
      border: 1px dashed #bbb;
      width: 350px;
      height: 160px;
      text-align: center;
      line-height: 160px;
   }
   .drop{
       line-height: 80px;
       color: #bbb;
      i {
        font-size: 60px;
        display: block;
      }
   }
}
</style>

```

æ­¥éª¤3ï¼šåœ¨å…¶ä»–ç»„ä»¶å¼•å…¥è¯¥ç»„ä»¶è¿›è¡Œä½¿ç”¨ï¼š

```vue
<template>
  <div>
    <UploadExcel :on-success="onSuccess"></UploadExcel>
  </div>
</template>

<script>
import { importEmployeesAPI } from '@/api/index.js'
export default {
  name: 'ImportIndex',
  components: {},
  data() {
    return {

    }
  },
  created() {},
  mounted() {},
  methods: {
    async onSuccess({ results, header }) {
      // ç”Ÿæˆæ˜ å°„å…³ç³»ï¼Œå› ä¸ºç”Ÿæˆçš„æ•°æ®é‡Œé¢çš„keyå€¼æ˜¯ä¸­æ–‡ï¼Œä½†æ˜¯åç«¯åˆéœ€è¦å¯¹åº”çš„è‹±æ–‡ï¼Œæ‰€ä»¥è¿™é‡Œè¦è¿›è¡Œkeyå€¼æ›¿æ¢
      const userRelations = {
        'å…¥èŒæ—¥æœŸ': 'timeOfEntry',
        'æ‰‹æœºå·': 'mobile',
        'å§“å': 'username',
        'è½¬æ­£æ—¥æœŸ': 'correctionTime',
        'å·¥å·': 'workNumber'
      }
      // åŒé‡å¾ªç¯å°†åŸæ•°æ®ä¸­çš„å±æ€§åæ¢äº†
      const data = results.map(t => {
        const item = {}
        for (var key in t) {
          const newKey = userRelations[key]
          item[newKey] = t[key]
        }
        return item
      })
      // å‘é€è¯·æ±‚ä¸Šä¼ è¡¨æ ¼
      await importEmployeesAPI(data)
      this.$message.success('æ“ä½œæˆåŠŸ')
    }
  }
}
</script>

<style lang="scss" scoped>

</style>

```

å¯¼å…¥è¡¨æ ¼æ€»ç»“ï¼š

â€‹		(1)å…ˆå®‰è£…xlsxåŒ…ï¼š`$ npm i xlsx`ï¼›

â€‹		(2)é€šè¿‡vue-element-adminå•ç‹¬å°è£…ä¸€ä¸ªä¸Šä¼ è¡¨æ ¼ã€è§£æè¡¨æ ¼å†…å®¹çš„åŠŸèƒ½ç»„ä»¶ï¼Œå…¨å±€å¼•å…¥ç»„ä»¶ï¼›è®¾ç½®å¯¹åº”çš„è·¯ç”±ï¼›

â€‹		(3)åœ¨éœ€è¦å¯¼å…¥è¡¨æ ¼çš„ç»„ä»¶ä¸­å¼•å…¥è¯¥ç»„ä»¶ï¼Œç„¶åä½¿ç”¨è¯¥ç»„ä»¶çš„*onSuccess()*æ–¹æ³•å¹¶æ¥æ”¶è¯¥ç»„ä»¶å¤„ç†è¿‡åçš„è¡¨æ ¼æ•°æ®ï¼ˆresults, headerï¼‰ï¼›

â€‹		(4)å› ä¸ºåç«¯éœ€è¦çš„æ•°æ®å¯¹è±¡çš„é”®åä¸æ”¯æŒä¸­æ–‡ï¼Œæ‰€ä»¥è¿˜è¦é€šè¿‡ä¸€ä¸ªæ˜ å°„å…³ç³»å°†ä¼ å…¥è¡¨æ ¼æ•°æ®çš„ä¸­æ–‡é”®åè½¬æ¢ä¸ºè‹±æ–‡é”®åï¼ˆé”®åå…¶å®å°±æ˜¯è¡¨å¤´ï¼‰ï¼›

â€‹		(5)æœ€åè°ƒç”¨ä¸Šä¼ APIå‘é€è¯·æ±‚ï¼Œå‘é€æˆåŠŸåè¿›è¡Œæç¤ºï¼›



å¯¼å‡ºï¼š

Excel çš„å¯¼å…¥å¯¼å‡ºéƒ½æ˜¯ä¾èµ–äº[js-xlsx (opens new window)](https://github.com/SheetJS/js-xlsx)æ¥å®ç°çš„ã€‚

åœ¨ `js-xlsx`çš„åŸºç¡€ä¸Šåˆå°è£…äº†[Export2Excel.js (opens new window)](https://github.com/PanJiaChen/vue-element-admin/blob/master/src/vendor/Export2Excel.js)æ¥æ–¹ä¾¿å¯¼å‡ºæ•°æ®ï¼›

ç”±äº `Export2Excel`ä¸ä»…ä¾èµ–`js-xlsx`è¿˜ä¾èµ–`file-saver`å’Œ`script-loaderï¼›`

â€‹		æ­¥éª¤1ï¼šä¸Šé¢ä»¥åŠå®‰è£…äº†xlsxï¼Œæ¥ä¸‹æ¥å®‰è£…`file-saver`å’Œ`script-loaderï¼›`

```bash
npm install xlsx file-saver -S
npm install script-loader -S -D
```

â€‹		æ­¥éª¤2ï¼šå°†*Export2Excel*æ–‡ä»¶ä¸‹è½½åæ”¾åœ¨*src/vendor/*æ–‡ä»¶å¤¹ä¸‹

â€‹		æ­¥éª¤3ï¼šç»™å¯¼å‡ºæŒ‰é’®ç»‘å®šç‚¹å‡»äº‹ä»¶ï¼Œäº‹ä»¶å‡½æ•°é‡Œé¢æ‡’åŠ è½½Export2Excelè°ƒç”¨é‡Œé¢çš„å‡½æ•°è¿›è¡Œæ•°æ®å¯¼å‡º

```js
// ç‚¹å‡»æŒ‰é’®å¯¼å‡ºå‘˜å·¥åˆ—è¡¨
    onExport() {
      import('@/vendor/Export2Excel').then(async excel => {
        // å‘é€è¯·æ±‚è·å–æ‰€æœ‰å‘˜å·¥åˆ—è¡¨
        const { rows } = await getemployeesInfoAPI({
          page: 1,
          size: this.pageData.total // æ•°æ®æ€»æ¡æ•°
        })
        // console.log(rows)
        // æ˜ å°„å…³ç³»è¿›è¡Œè¡¨å¤´ä¸­æ–‡è½¬æ¢
        const headers = {
          'æ‰‹æœºå·': 'mobile',
          'å§“å': 'username',
          'å…¥èŒæ—¥æœŸ': 'timeOfEntry',
          'è˜ç”¨å½¢å¼': 'formOfEmployment',
          'è½¬æ­£æ—¥æœŸ': 'correctionTime',
          'å·¥å·': 'workNumber',
          'éƒ¨é—¨': 'departmentName'
        }
        const data = rows.map(item => {
          // è·å–æ‰€æœ‰è¡¨å¤´çš„å€¼ç»„æˆä¸€ä¸ªå¯¹è±¡o-é€šè¿‡ladashä¸­çš„pick()
          const o = pick(item, Object.values(headers))
          // å°†æ—¶é—´ã€è˜ç”¨å½¢å¼æ ¼å¼åŒ–-é€šè¿‡å…¬å…±æ–¹æ³•ï¼ˆè§†é¡¹ç›®éœ€æ±‚æ‰§è¡Œè¿™ä¸¤å¥ä»£ç ï¼‰
          o.timeOfEntry = formatDate(o.timeOfEntry)
          o.formOfEmployment = formatEmployment(o.formOfEmployment)
          // é€šè¿‡Object.values()å–åˆ°å¯¹è±¡oçš„æ¯ä¸ªå±æ€§å¯¹åº”çš„å±æ€§å€¼å¹¶è¿”å›
          return Object.values(o)
        })
        // é€šè¿‡Export2Excelçš„export_json_to_excel()æ–¹æ³•ç”Ÿæˆè¡¨æ ¼
        excel.export_json_to_excel({
          header: Object.keys(headers), // è¡¨å¤´ å¿…å¡« Array
          data, // å…·ä½“è¡¨ä½“å†…å®¹æ•°æ®ï¼Œåœ¨ä¸Šé¢ä»¥è¿›è¡Œè½¬æ¢ å¿…å¡« Array
          filename: 'å‘˜å·¥ä¿¡æ¯è¡¨', // éå¿…å¡« å¯¼å‡ºè¡¨æ ¼åç§°
          autoWidth: true, // éå¿…å¡«ï¼Œå•å…ƒæ ¼æ˜¯å¦è¦è‡ªé€‚åº”å®½åº¦
          bookType: 'xlsx' // éå¿…å¡«ï¼Œå¯¼å‡ºæ–‡ä»¶ç±»å‹
        })
      })
    },
```

è¡¨æ ¼å¯¼å‡ºæ€»ç»“ï¼š

â€‹		åˆ©ç”¨js-xlsxäºŒæ¬¡å°è£…äº†*Export2Excel*ï¼Œä¸‹è½½å¦å¤–ä¸¤ä¸ªä¾èµ–åŒ…ï¼ˆ`file-saver`å’Œ`script-loader`ï¼‰;

â€‹		ç‚¹å‡»å¯¼å‡ºè¡¨æ ¼æ—¶å¯¹*Export2Excel*æ–‡ä»¶è¿›è¡Œæ‡’åŠ è½½ï¼Œç„¶åä½¿ç”¨è¯¥æ–‡ä»¶å¯¼å‡ºçš„æ–¹æ³•ï¼Œåœ¨å…¶æ–¹æ³•å†…å‘é€è¯·æ±‚è·å–æ‰€æœ‰çš„å‘˜å·¥åˆ—è¡¨ï¼›

â€‹		å› ä¸ºè¯·æ±‚è·å–çš„æ•°æ®çš„é”®åæ˜¯è‹±æ–‡çš„ï¼ˆè¡¨å¤´ï¼‰ï¼Œæ‰€ä»¥éœ€è¦ç”³æ˜ä¸€ä¸ªæ˜ å°„å…³ç³»æ¥å¯¹è·å–çš„æ•°æ®è¿›è¡Œä¸­æ–‡è½¬æ¢ï¼Œ

ç„¶åå†ä½¿ç”¨*Export2Excel*æ–‡ä»¶çš„æ–¹æ³•ï¼ˆexport_json_to_excelï¼‰å°†è¡¨æ ¼æ•°æ®ä¼ è¿›å»è¿›è¡Œè¡¨æ ¼å¯¼å‡ºï¼›



## æƒé™ç®¡ç†ğŸ’¡

â€‹		åœ¨è¿™ä¸ªé¡¹ç›®ä¸­æƒé™ç®¡ç†åŒ…æ‹¬ï¼šæ¥å£æƒé™ç®¡ç†ã€è·¯ç”±(é¡µé¢è·³è½¬)æƒé™ç®¡ç†ã€èœå•(åŠ¨æ€è·¯ç”±)æƒé™ã€æŒ‰é’®æƒé™çš„ç®¡ç†ï¼›

â€‹		1.æ¥å£æƒé™ç®¡ç†-å®ç°æ­¥éª¤

â€‹		æ¥å£æƒé™ç®¡ç†ï¼šå› ä¸ºå¾ˆå¤šæ¥å£è¦ç”¨æˆ·ç™»å½•åæ‰èƒ½è®¿é—®ï¼Œè®¿é—®çš„æ—¶å€™ä¸€èˆ¬é€šè¿‡`jwt`(JSON Web Token)çš„å½¢å¼æ¥éªŒè¯çš„ï¼›ç™»å½•æˆåŠŸçš„æ—¶å€™å°±å°†tokenå­˜èµ·æ¥(å­˜åœ¨vuexå’Œcookie)ï¼Œç„¶åé€šè¿‡*axios*çš„`è¯·æ±‚æ‹¦æˆªå™¨`é‡Œé¢ï¼Œç»™headersåŠ ä¸Štokenï¼›å¦‚æœæ²¡æœ‰tokenæˆ–è¿‡æœŸçš„æ—¶å€™ï¼ŒæœåŠ¡å™¨ä¸€èˆ¬ä¼šå“åº”`401`çš„å“åº”çŠ¶æ€ç ï¼Œè¿™æ—¶ä¼šåœ¨å“åº”æ‹¦æˆªå™¨é‡Œé¢è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœè¿‡æœŸæˆ–æ²¡æœ‰å°±è·³è½¬åˆ°ç™»å½•é¡µé¢ï¼›



â€‹		2.è·¯ç”±æƒé™ç®¡ç†-å®ç°æ­¥éª¤

â€‹		(1)ä¸€èˆ¬ä¸€äº›é¡µé¢çš„è®¿é—®éœ€è¦tokenä¸”æ²¡æœ‰è¿‡æœŸæ‰èƒ½å®ç°ï¼Œæ‰€ä»¥å†é¡µé¢è·¯ç”±è·³è½¬çš„æ—¶å€™æˆ‘åœ¨è·¯ç”±å®ˆå«çš„å‰ç½®å®ˆå«ä¸­æ ¹æ®tokenå¯¹é¡µé¢çš„è·³è½¬è¿›è¡Œæƒé™ç®¡ç†ï¼›

â€‹		(2)å› ä¸ºä¸€äº›é¡µé¢çš„è·³è½¬ä¸éœ€è¦tokenå°±èƒ½è·³è½¬(æ¯”å¦‚ç™»å½•ã€404é¡µé¢)ï¼Œæ‰€ä»¥æˆ‘å…ˆè®¾ç½®ä¸€ä»½ç™½åå•ï¼Œç„¶ååˆ¤æ–­æ˜¯å¦æœ‰tokenï¼Œ`å¦‚æœæœ‰`ï¼Œå†åšä¸ªå…ç™»å½•åˆ¤æ–­ï¼ˆå°±æ˜¯è¦è·³è½¬çš„é¡µé¢å¦‚æœæ˜¯ç™»å½•é¡µé¢ï¼Œå°±è®©å…¶ç›´æ¥é‡å®šå‘åˆ°é¦–é¡µï¼‰ï¼Œå¦‚æœè·³è½¬çš„æ˜¯å…¶ä»–é¡µé¢ï¼Œå°±ç›´æ¥æ”¾è¡Œï¼›`å¦‚æœæ²¡æœ‰`ï¼Œå°±åˆ¤æ–­è¦è·³è½¬çš„é¡µé¢æ˜¯å¦åœ¨ç™½åå•é‡Œé¢ï¼Œå¦‚æœåœ¨å°±æ”¾è¡Œï¼Œå¦‚æœæ²¡åœ¨å°±è®©å…¶é‡å®šå‘åˆ°ç™»å½•é¡µé¢ï¼›



â€‹		3.èœå•æƒé™ç®¡ç†-å®ç°æ­¥éª¤

â€‹		(1)èœå•çš„æƒé™ç®¡ç†æ˜¯é€šè¿‡`RBAC`çš„æƒé™è®¾è®¡æ€æƒ³å®ç°çš„ï¼Œå› ä¸ºä¸åŒç”¨æˆ·ç¾¤çœ‹åˆ°çš„èœå•æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥å…ˆç»™ä¸åŒçš„ç”¨æˆ·åˆ†é…ä¸åŒè§’è‰²ï¼Œå†é€šè¿‡ç»™ä¸åŒçš„è§’è‰²å±•ç¤ºä¸åŒçš„èœå•ï¼›åˆ¤æ–­ä¸€ä¸ªè§’è‰²æ˜¯å¦æ‹¥æœ‰æŸä¸ªèœå•æ˜¯é€šè¿‡åç«¯è¿”å›çš„ç”¨æˆ·ä¿¡æ¯ä¸­rolesä¸­çš„menusä¸­åˆ¤æ–­çš„ï¼›

â€‹		(2)å…·ä½“çš„æ“ä½œæ˜¯åœ¨ç™»å½•å®Œæˆåï¼Œåœ¨å‰ç½®å®ˆå«ä¸­è·å–ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ï¼Œç„¶åå°†è®¾ç½®å¥½çš„åŠ¨æ€è·¯ç”±å¼•å…¥ï¼Œé€šè¿‡ç”¨æˆ·ä¿¡æ¯ä¸­menusæ¥ç­›é€‰æ‰€æœ‰çš„åŠ¨æ€è·¯ç”±ï¼Œç„¶åå†é€šè¿‡router.addRouters()å°†åŠ¨æ€è·¯ç”±æ·»åŠ åˆ°è·¯ç”±é…ç½®è¡¨ä¸­ï¼›ç„¶åå†å°†ç­›é€‰åçš„åŠ¨æ€è·¯ç”±å’Œé™æ€è·¯ç”±åˆå¹¶é‡æ–°èµ‹å€¼ç»™vueåŸå§‹é…ç½®ä¸­çš„routesï¼ˆè§£å†³èœå•æ²¡æœ‰åˆ·æ–°ï¼‰ï¼›

â€‹		(3)æœ€åè¿”å›ä¸€ä¸ª`next(to.path)`è§£å†³é¡µé¢åˆ·æ–°åæ‰¾ä¸åˆ°é¡µé¢ï¼ˆ404ï¼‰ï¼ˆ`è¿™æ˜¯ä¸ªå‘ç‚¹`ï¼‰



â€‹		4.æŒ‰é’®æƒé™ç®¡ç†-å®ç°æ­¥éª¤

â€‹		(1)å› ä¸ºç”¨æˆ·æ˜¯å¦èƒ½ç‚¹å‡»ä¹Ÿæ˜¯æ ¹æ®ä¸ªäººåŸºæœ¬ä¿¡æ¯ä¸­çš„rolesä¸­çš„pointé‡Œé¢æ˜¯å¦æœ‰æŒ‰é’®çš„æ ‡è¯†ç¬¦æ¥åˆ¤æ–­çš„ï¼Œå› ä¸ºæŒ‰é’®ä¸æ­¢ä¸€ä¸ªåœ°æ–¹ç”¨åˆ°ï¼Œæ‰€ä»¥æˆ‘æ˜¯åˆ©ç”¨äº†`mixin`æ··å…¥å¯¹è±¡åšäº†ä¸ªå…¨å±€çš„æ–¹æ³•ï¼›

â€‹		(2)å…·ä½“æ­¥éª¤æ˜¯åœ¨srcä¸‹é¢æ–°å»ºä¸€ä¸ªmixinæ–‡ä»¶å¤¹ï¼Œå†åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­å»ºä¸€ä¸ªjsæ–‡ä»¶ï¼Œé‡Œé¢é»˜è®¤å¯¼å‡ºäº†ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡é‡Œé¢å°è£…ä¸€ä¸ªmethodså¯¹è±¡ä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œæœ€ååœ¨`main.js`ä¸­åˆ©ç”¨`Vue.mixin()`å…¨å±€æ³¨å†Œæ··å…¥å¯¹è±¡ï¼Œç„¶åå†åœ¨å¯¹åº”çš„æŒ‰é’®åœ°æ–¹ä½¿ç”¨ï¼Œä½¿ç”¨æ—¶å°†å¯¹åº”æŒ‰é’®çš„æ ‡è¯†ç¬¦ä¼ è¿›å»ï¼›



è·¯ç”±æƒé™ç®¡ç†å®ç°æ­¥éª¤æ€è·¯ï¼š

```js
/**
 * 1.æ€»ä½“æ€è·¯ï¼šé¡µé¢è®¿é—®çš„æƒé™æ‹¦æˆªæ“ä½œ => æ“ä½œåœ¨src/permission.jsä¸­è¿›è¡Œæ“ä½œ  => æƒé™æ‹¦æˆªæ“ä½œéœ€è¦åœ¨å‰ç½®å®ˆå«ä¸­è¿›è¡Œæ“ä½œ
 *   æ‰©å……çŸ¥è¯†ç‚¹ï¼šç™½åå•=>å°±æ˜¯ç”¨æˆ·è®¿é—®æ—¶ä¸éœ€è¦tokenå°±èƒ½è®¿é—®åˆ°çš„é¡µé¢
 * 2.æ“ä½œé€»è¾‘ï¼ˆåˆ¤æ–­åŸåˆ™ï¼‰ï¼šé€šè¿‡åˆ¤æ–­æ˜¯å¦æœ‰token å’Œè¦è·³è½¬çš„ç›®çš„é¡µé¢æ˜¯å¦åœ¨ç™½åå•é‡Œé¢è¿›è¡Œå¯¹åº”çš„æ“ä½œ
 *     1.1 å¦‚æœæœ‰tokenï¼Œåˆ¤æ–­éœ€è¦è®¿é—®çš„é¡µé¢æ˜¯å¦æ˜¯ç™»å½•é¡µï¼Œå¦‚æœæ˜¯ç™»å½•é¡µå°±ç›´æ¥è·³è½¬åˆ°ä¸»é¡µï¼ˆå…ç™»å½•æ“ä½œï¼Œä¸šåŠ¡é¢è¯•ç‚¹ï¼‰
 *     1.2 å¦‚æœæœ‰tokenï¼Œåˆ¤æ–­éœ€è¦è®¿é—®çš„é¡µé¢æ˜¯å¦æ˜¯ç™»å½•é¡µï¼Œå¦‚æœä¸æ˜¯ç™»å½•é¡µå°±ç›´æ¥è·³è½¬çš„ï¼Œå°±æ”¾è¡Œï¼Œè®©å…¶ç›´æ¥è·³è½¬åˆ°å¯¹åº”è¦è®¿é—®çš„é¡µé¢
 *
 *     2.1 å¦‚æœæ²¡æœ‰tokenï¼Œåˆ¤æ–­è·³è½¬çš„ ç›®çš„é¡µé¢ æ˜¯å¦åœ¨ç™½åå•é‡Œé¢ï¼Œå¦‚æœåœ¨ç™½åå•ï¼Œå°±è¿›è¡Œæ”¾è¡Œè¿›è¡Œè·³è½¬
 *     2.2 å¦‚æœæ²¡æœ‰tokenï¼Œåˆ¤æ–­è·³è½¬çš„ ç›®çš„é¡µé¢ æ˜¯å¦åœ¨ç™½åå•é‡Œé¢ï¼Œå¦‚æœæ²¡æœ‰åœ¨ç™½åå•ï¼Œå°±è·³è½¬åˆ°ç™»å½•é¡µé¢
 *
 *  3.permission.jsä¸­è¿›è¡Œæ“ä½œå®Œæˆåï¼Œéœ€è¦åœ¨main.jsä¸­å¼•å…¥è¯¥æ–‡ä»¶
 *
 * */
```

å®ç°æ­¥éª¤ä»£ç ï¼š

```js
// 1. å¼•å…¥router
import router from '@/router/index.js'
// å¼•å…¥ vuex
import store from '@/store/index.js'

// å¼•å…¥è¿›åº¦æ¡åŠè¿›åº¦æ¡æ ·å¼ => è¿›åº¦æ¡å¯åšå¯ä¸åš
import NProgress from 'nprogress' // å¼•å…¥ä¸€ä»½è¿›åº¦æ¡æ’ä»¶ NProgresséœ€è¦å®‰è£…
import 'nprogress/nprogress.css' // å¼•å…¥è¿›åº¦æ¡æ ·å¼

// 2. è®¾ç½®ç™½åå•
const whiteList = ['/login', '/404']

// 3. å‰ç½®å®ˆå«
router.beforeEach((to, from, next) => {
  /*
    next() => æ”¾è¡Œç»§ç»­è·³è½¬åˆ°æœ¬æ¥è¦è·³è½¬çš„é¡µé¢
    next(false) => é˜»æ­¢é¡µé¢è·³è½¬
    next('è·¯ç”±è·¯å¾„') => é‡å®šå‘è·³è½¬åˆ°è®¾å®šé¡µé¢
  */

  NProgress.start() // å¼€å¯è¿›åº¦æ¡

  // åˆ¤æ–­vuexä¸­æ˜¯å¦æœ‰token
  if (store.state.user.token) {
    // åˆ¤æ–­è¦è·³è½¬çš„é¡µé¢æ˜¯å¦æ˜¯ç™»å½•é¡µé¢
    if (to.path === '/login') {
      // ç›´æ¥é‡å®šå‘åˆ°é¦–é¡µ
      next('/')
      NProgress.done() // æ‰‹åŠ¨å¼ºåˆ¶å…³é—­ä¸€æ¬¡è¿›åº¦æ¡  ä¸ºäº†è§£å†³ æ‰‹åŠ¨åˆ‡æ¢åœ°å€æ—¶  è¿›åº¦æ¡çš„ä¸å…³é—­çš„é—®é¢˜
    } else {
      // æ”¾è¡Œ
      next()
    }
  } else {
    // åˆ¤æ–­è¦è·³è½¬çš„ç›®çš„é¡µé¢æ˜¯å¦åœ¨ç™½åå•ä¸Šé¢
    if (whiteList.includes(to.path)) {
      next()
    } else {
      // ä¸åœ¨ç™½åå•å°±å¼ºåˆ¶è·³è½¬åˆ°ç™»å½•é¡µé¢
      next('/login')
      NProgress.done() // æ‰‹åŠ¨å¼ºåˆ¶å…³é—­ä¸€æ¬¡  ä¸ºäº†è§£å†³ æ‰‹åŠ¨åˆ‡æ¢åœ°å€æ—¶  è¿›åº¦æ¡çš„ä¸å…³é—­çš„é—®é¢˜
    }
  }
})

// 4. åç½®å®ˆå«
router.afterEach(() => {
  NProgress.done() // å…³é—­è¿›åº¦æ¡
})

```



## å›½é™…åŒ–å¤„ç†ğŸ’¡

æ­¥éª¤ï¼š

â€‹		1.å®‰è£…å›½é™…åŒ–çš„åŒ…i18nï¼š`npm i vue-i18n`;

â€‹		2.å°è£…ä¸€ä¸ª`VueI18n`çš„å®ä¾‹æ–‡ä»¶ï¼Œå¹¶å…¨å±€æ³¨å†Œå›½é™…åŒ–åŒ…(Vue.use())ï¼Œå¹¶å°†ï¼Œé‡Œé¢é…ç½®éœ€è¦*element-iu*è¯­è¨€åŒ…ä»¥åŠé¡¹ç›®å¯¹åº”çš„è‡ªå®šä¹‰è¯­è¨€æ˜ å°„åŒ…ï¼ˆè‡ªå·±ç¼–æ’°çš„ï¼‰ï¼›

â€‹		3.åœ¨main.jsä¸­å¯¹æŒ‚è½½VueI18nçš„æ’ä»¶ï¼Œå¹¶è®¾ç½®elementä¸ºå½“å‰çš„è¯­è¨€ï¼›

â€‹		4.åœ¨ç»„ä»¶ä¸­éœ€è¦åšå›½é™…åŒ–çš„åœ°æ–¹ é€šè¿‡è½¬åŒ–æ–¹æ³•$tï¼Œå®ƒä¼šæ ¹æ®ä¼ å…¥çš„keyï¼Œè‡ªåŠ¨çš„å»å¯»æ‰¾å½“å‰è¯­è¨€çš„æ–‡æœ¬ï¼›

â€‹		5.å°è£…ç‚¹å‡»åˆ‡æ¢è¯­è¨€çš„æŒ‰é’®ï¼Œç‚¹å‡»çš„æ—¶å€™å°†*locale*çš„å€¼æ›¿æ¢ä¸ºå¯¹åº”è¯­è¨€åŒ…çš„å…³é”®å­—ï¼›åœ¨ç»„ä»¶ä¸­ä½¿ç”¨è¯¥ç»„ä»¶ï¼›

å®ç°ä»£ç ï¼š

â€‹		åœ¨*src/lang/index.js*ä¸­å¯¹`VueI18n`çš„å®ä¾‹è¿›è¡Œå°è£…ï¼š

```js
// å¦‚æœä½¿ç”¨æ¨¡å—ç³»ç»Ÿ (ä¾‹å¦‚é€šè¿‡ vue-cli)ï¼Œåˆ™éœ€è¦å¯¼å…¥ Vue å’Œ VueI18n ï¼Œç„¶åè°ƒç”¨ Vue.use(VueI18n)ã€‚
import Vue from 'vue'
import VueI18n from 'vue-i18n'
import Cookies from 'js-cookie'
// å¼•å…¥element-uiçš„è¯­è¨€åŒ…
import enLocale from 'element-ui/lib/locale/lang/en'
import zhLocale from 'element-ui/lib/locale/lang/zh-CN'
import en from './en.js'
import zh from './zh.js'

Vue.use(VueI18n)

// å‡†å¤‡ç¿»è¯‘çš„è¯­è¨€ç¯å¢ƒä¿¡æ¯

// é€šè¿‡é€‰é¡¹åˆ›å»º VueI18n å®ä¾‹
const i18n = new VueI18n({
  // ä»cookiesä¸­å–å‡ºå…³é”®å­—
  locale: Cookies.get('lang') || 'zh', // è®¾ç½®åœ°åŒº
  messages: {
    en: {
      ...enLocale, // elmeè‹±æ–‡åŒ…
      ...en // è‡ªå®šä¹‰é¡¹ç›®è‹±æ–‡åŒ…
    },
    zh: {
      ...zhLocale,
      ...zh // è‡ªå®šä¹‰é¡¹ç›®ä¸­æ–‡åŒ…
    }
  } // è®¾ç½®åœ°åŒºä¿¡æ¯
})

// å¯¼å‡ºi18n,
export default i18n
// é€šè¿‡ `i18n` é€‰é¡¹åˆ›å»º Vue å®ä¾‹
// new Vue({ i18n }).$mount('#app')

// ç°åœ¨åº”ç”¨ç¨‹åºå·²ç»å‡†å¤‡å¥½äº†ï¼

```



â€‹		*main.js*ä¸­å¼•å…¥æ³¨å†Œï¼š

```js
// å¼•å…¥i18n
import i18n from '@/lang/index.js'
// æ³¨å†Œ
Vue.use(ElementUI, {
  i18n: (key, value) => i18n.t(key, value)
})
// æŒ‚è½½
new Vue({
  el: '#app',
  i18n,
  render: h => h(App)
})
```



â€‹		åœ¨*src/components/lang/index.vue*å°è£…åˆ‡æ¢è¯­è¨€æ’ä»¶ï¼Œå¹¶å…¨å±€æ³¨å†Œè¯¥ç»„ä»¶ï¼š

```vue
<template>
  <el-dropdown trigger="click" class="international" @command="handleSetLanguage">
    <div>
      <svg-icon class-name="international-icon" icon-class="language" style="color: #fff; font-size: 24px;" />
    </div>
    <el-dropdown-menu slot="dropdown">
      <el-dropdown-item :disabled="language==='zh'" command="zh">
        ä¸­æ–‡
      </el-dropdown-item>
      <el-dropdown-item :disabled="language==='en'" command="en">
        English
      </el-dropdown-item>
    </el-dropdown-menu>
  </el-dropdown>
</template>

<script>
// è¯­è¨€æŒä¹…åŒ–ï¼Œå¼•å…¥å­˜å‚¨è¿›cookie
import Cookies from 'js-cookie'
export default {
  computed: {
    language() {
      return this.$store.getters.language
    }
  },
  methods: {
    handleSetLanguage(lang) {
      // æ›´æ¢è¯­è¨€åŒ…å…³é”®è¯
      // ç‚¹å‡»åˆ¤æ–­å…³é”®è¯æ˜¯'zh'è¿˜æ˜¯'en',å¯¹åº”åˆ‡æ¢è¯­è¨€
      this.$i18n.locale = this.$i18n.locale === 'zh' ? 'en' : 'zh'
      // åˆ‡æ¢è¯­è¨€æŒä¹…åŒ–
      Cookies.set('lang', this.$i18n.locale)
      this.$message({
        message: 'Switch Language Success',
        type: 'success'
      })
    }
  }
}
</script>

```



## æ··å…¥mixinğŸ’¡

æ··å…¥mixinå°±æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å¯¼å‡ºçš„æ–¹æ³•æ˜¯æ¯ä¸ªç»„ä»¶ä¸­æœ‰çš„å…¬ç”¨æ–¹æ³•ï¼›

1.åœ¨src/mixin/å¯¹åº”æ–¹æ³•åçš„jsæ–‡ä»¶ï¼Œåœ¨è¿™é‡Œé¢å°è£…å¯¹åº”çš„å…¬å…±æ–¹æ³•ï¼š

```js
// å°è£…å…¨å±€æ··å…¥å¯¹è±¡
import store from '@/store/index.js'
// åªç”¨é»˜è®¤å¯¼å‡ºä¸€ä¸ªå¯¹è±¡å³å¯
export default {
  methods: {
    checkPermission(key) {
      // å…ˆå–åˆ°å­˜åœ¨vuexä¸­çš„ç”¨æˆ·ä¸ªäººä¿¡æ¯è¿›è¡Œè§£æ„
      const { userInfo } = store.state.user
      // æ ¹æ®ç”¨æˆ·ä¸ªäººä¿¡æ¯ä¸­çš„pointï¼ˆæ•°ç»„ï¼‰è¿›è¡Œåˆ¤æ–­è¯¥ç”¨æˆ·å¯¹åº”çš„è§’è‰²æ˜¯å¦æœ‰è¯¥æƒåˆ©ï¼ˆæ–°å¢éƒ¨é—¨ã€æ–°å¢å‘˜å·¥ç­‰åŠŸèƒ½ï¼‰
      if (userInfo.roles.point && userInfo.roles.point.length) {
        return userInfo.roles.point.some(item => item === key)
      } else {
        return false
      }
    }
  }
}
```

2.åœ¨main.jsä¸­å¼•å…¥ã€æ³¨å†Œå¯¹åº”æ–¹æ³•ï¼š

```js
// å¼•å…¥mixinæ··å…¥å¯¹è±¡
import CheckPermission from '@/mixin/checkPermission.js'

// å…¨å±€æ³¨å†Œmixinæ··å…¥å¯¹è±¡
Vue.mixin(CheckPermission) // è¡¨ç¤ºæ‰€æœ‰ç»„ä»¶éƒ½å¯ä»¥ä½¿ç”¨è¯¥æ–¹æ³•
```

3.åœ¨å¯¹åº”ç»„ä»¶ä¸­**æ­£å¸¸ä½¿ç”¨**å¯¹åº”çš„æ–¹æ³•ï¼ˆä¸ç”¨å†å¼•å…¥ä¹‹ç±»çš„ï¼‰ï¼›



## æ•°æ®æ¨¡æ‹ŸmockjsğŸ’¡

1.å®‰è£…ä¾èµ– `npm install mockjs`

2.åœ¨src/util/mock.jsä¸­å¼•å…¥è¿›è¡Œæ•°æ®æ¨¡æ‹Ÿ

```js
import mock from 'mockjs'
// ä¸€å¤§å‘ç‚¹å°±æ˜¯è¯·æ±‚æ¥å£ä¸èƒ½å†™å…¨
mock.mock('/api/sys/profile', 'post', function() { // å‡½æ•°é‡Œé¢è¿”å›çš„æ˜¯æ­£å¸¸æ¥å£è¿”å›çš„æ‰€æœ‰æ•°æ®
  return {
    success: true,
    code: 10000,
    message: 'æ“ä½œæˆåŠŸï¼',
    data: {
      userId: '1066370498633486336',
      mobile: '13800000002',
      username: 'ç®¡ç†å‘˜',
      company: 'ä¼ æ™ºæ’­å®¢',
      companyId: '1',
      roles: {
        apis: [],
        menus: [
          'settings',
          'social_securitys',
          'permissions',
          'approvals',
          'salarys',
          'departments',
          'employees',
          'attendances'
        ],
        points: ['2', 'point-dept']
      },
      authCacheKey: null
    }
  }
})

```

3.åœ¨main.jsæ–‡ä»¶ä¸­å¼•å…¥å³å¯ï¼ˆæ³¨æ„ï¼šåªåœ¨å¼€å‘ç¯å¢ƒå¼•å…¥ï¼‰

```js
// å¼•å…¥æ¨¡æ‹Ÿæ•°æ®(è¿›è¡Œä¸‹é¢åˆ¤æ–­ï¼Œè®©æ¨¡æ‹Ÿæ•°æ®åªåœ¨å¼€å‘ç¯å¢ƒä¸­å¼•å…¥)
if (process.env.NODE_ENV === 'development') {
  require('@/utils/mock.js')
}
```



























