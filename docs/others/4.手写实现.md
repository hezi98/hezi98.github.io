---
title: å‰ç«¯æ‰‹å†™å®ç°
---



## æ‰‹å†™å®ç°ä¸€ä¸ªnew

1. åˆ›å»ºä¸€ä¸ªç©ºçš„ç®€å•JavaScriptå¯¹è±¡ï¼ˆå³{}ï¼‰ï¼›
2. ä¸ºæ­¥éª¤1æ–°åˆ›å»ºçš„å¯¹è±¡æ·»åŠ å±æ€§`__proto__`ï¼Œå°†è¯¥å±æ€§é“¾æ¥è‡³æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ ï¼›
3. å°†æ­¥éª¤1æ–°åˆ›å»ºçš„å¯¹è±¡ä½œä¸ºthisçš„ä¸Šä¸‹æ–‡ ï¼›
4. å¦‚æœè¯¥å‡½æ•°æ²¡æœ‰è¿”å›å¯¹è±¡ï¼Œåˆ™è¿”å›thisã€‚

> newå…³é”®è¯æ‰§è¡Œåæ€»ä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡, è¦ä¹ˆæ˜¯å®ä¾‹å¯¹è±¡, è¦ä¹ˆæ˜¯returnè¯­å¥æŒ‡å®šçš„å¯¹è±¡.

```js
function _new(fn,...args){
    // let obj = new Object()
    // obj.__proto__ = fn.prototype
    // åŸºäºfnæ„é€ å‡½æ•°åŸå‹åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡
    let obj = Object.create(fn.prototype)
    // æ‰§è¡Œæ„é€ å‡½æ•°ï¼Œå¹¶è·å–fnæ‰§è¡Œçš„ç»“æœ
    let res = fn.call(obj,...args) 
    // å¦‚æœæ‰§è¡Œç»“æœæœ‰è¿”å›å€¼å¹¶ä¸”æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¿”å›æ‰§è¡Œç»“æœï¼Œå¦åˆ™ï¼Œè¿”å›æ–°åˆ›å»ºçš„å¯¹è±¡
    let isObject = typeof res === 'object' && res !== null
    let isFunction = typeof res === 'function'
    return isObject || isFunction  ? res : obj
}

// æ›´å¥½ç†è§£
function myNew(fn, ...args) {
  let obj = Object.create(fn.prototype)
  let res = fn.call(obj,...args)
  
  if (res && (typeof res === 'object' || typeof res === 'function')) retrun res
  return obj
}
```

## Object.create

```js
function create (o) {
  function F() {}
  F.prototype = o
  return new F()
}
// åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œä»¥oä¸ºæ–°åˆ›å»ºå¯¹è±¡çš„åŸå‹å¯¹è±¡
```

## instanceof 

- Instanceof: ç”¨äºæ£€æµ‹æ„é€ å‡½æ•°çš„ `prototype` å±æ€§æ˜¯å¦å‡ºç°åœ¨æŸä¸ªå®ä¾‹å¯¹è±¡çš„åŸå‹é“¾ä¸Šã€‚
- é€šä¿—ä¸€ç‚¹å°±æ˜¯ï¼š åˆ¤æ–­newå‡ºçš„å®ä¾‹å¯¹è±¡æ˜¯å¦æ˜¯å½“å‰æ„é€ å‡½æ•°ç”Ÿæˆçš„å¯¹è±¡

```js
function my_instanceof(left, right) {
  // è¿™é‡Œå…ˆç”¨typeofæ¥åˆ¤æ–­åŸºç¡€æ•°æ®ç±»å‹ï¼Œå¦‚æœæ˜¯ï¼Œç›´æ¥è¿”å›false
  if(typeof left !== 'object' || left === null) return false;
  // getProtypeOfæ˜¯Objectå¯¹è±¡è‡ªå¸¦çš„API
  // è¿”å›æŒ‡å®šå¯¹è±¡çš„åŸå‹ï¼ˆå†…éƒ¨[[Prototype]]å±æ€§çš„å€¼ï¼‰éšå¼åŸå‹
  let proto = Object.getPrototypeOf(left);
  let prototype = right.prototype
  while(true) {                  //å¾ªç¯å¾€ä¸‹å¯»æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°ç›¸åŒçš„åŸå‹å¯¹è±¡
    if(proto === null) return false;
    if(proto === prototype) return true;//æ‰¾åˆ°ç›¸åŒåŸå‹å¯¹è±¡ï¼Œè¿”å›true
    proto = Object.getPrototypeof(proto);
    }
}

// æ›´å¥½ç†è§£ç‰ˆæœ¬
function my_instanceof(left, right) {
    if(typeof left !== 'object' || left === null) return false;

  	let proto = left.__proto__
    let prototype = right.prototype // å³è¾¹çš„åŸå‹
    while (true) {
        if (proto === null) return false
        if (proto === prototype) return true
        proto = proto.__proto__ // å‘ä¸ŠæŸ¥æ‰¾ï¼Œç›´åˆ°protoä¸ºnull
    }
}
```



## ğŸ”¥æ‰‹å†™Promise.all

1. å‚æ•°å¯è¿­ä»£
2. è¿”å›å€¼æ˜¯promise
3. å¦‚æœå…¨éƒ¨æˆåŠŸï¼ŒçŠ¶æ€å˜ä¸ºresolve
4. ä½†å‡¡æœ‰ä¸€ä¸ªå¤±è´¥ï¼ŒçŠ¶æ€å˜ä¸ºreject

```js
function PromiseAll(arr) {
    if(!Array.isArray(arr)) {
				return new TypeError(`${arr} is not iterable`)
    }
    return new Promise((resolve,reject) => {
        let result = []  // å­˜æ”¾ç»“æœ
        let count = 0 // è¿›å…¥fullfilledçš„promiseä¸ªæ•°
        
        for(let i = 0; i < arr.length; i++) {
            // è¿™é‡Œé»˜è®¤æŠŠæ‰€æœ‰å…¥å‚éƒ½åŒ…è£…æˆpromiseè¿”å›äº†
            // å› ä¸ºå¦‚æœæ˜¯æ™®é€šå€¼,åœ¨Promiseå†…éƒ¨å®ç° 2.3.4æ—¶, æœ‰è¿”å›å€¼çš„æ“ä½œ
            Promise.resolve(arr[i]).then(value => {
                // counter++;
                result[i] = value;
                if ( ++count === arr.length) resolve(result) //åˆ¤æ–­å·²ç»å®Œæˆ
                // åªè¦æœ‰ä¸€ä¸ªè¢«rejectedæ—¶, å°±reject
            }).catch(e => reject(e))
        }

    })
}

```

## æ‰‹å†™call, apply, bind

- https://juejin.cn/post/6844904042452221960#heading-9 å¯å‚è€ƒ
- https://juejin.cn/post/6844903809206976520#heading-10 å¯å‚è€ƒ
- å…±åŒç‚¹ï¼šéƒ½æ˜¯æ”¹å˜thisæŒ‡å‘ 
- åŒºåˆ«
  - call å’Œ applyæ˜¯ç«‹å³æ‰§è¡Œçš„ï¼Œè€Œbindæ˜¯è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œéœ€è¦æ‰‹åŠ¨å»è°ƒç”¨
  - callå¯ä»¥ä¼ é€’å¤šä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å’Œapply'ä¸€æ ·ï¼Œæ˜¯ç”¨æ¥æ›¿æ¢çš„å¯¹è±¡ï¼Œåè¾¹æ˜¯å‚æ•°åˆ—è¡¨
  - applyæœ€å¤šæ™ºèƒ½æœ‰ä¸¤ä¸ªå‚æ•°  ï¼ˆæ–°thiså¯¹è±¡ï¼Œæ•°ç»„argsArrayï¼‰->  fun.apply(thisArg, [argsArray])

#### call

- æ”¹å˜thisæŒ‡å‘
- å‡½æ•°ç«‹å³æ‰§è¡Œï¼Œè¿”å›æ‰§è¡Œç»“æœ
- https://juejin.cn/post/6844903906279964686#heading-19 å¯å‚è€ƒ

```js
Function.prototype._call = function(context, ...args) {
  	// åˆ¤æ–­ä¸Šä¸‹æ–‡å¯¹è±¡
    context = context ï¼ŸObject(context) : window
    // åˆ›é€ å”¯ä¸€keyå€¼ï¼Œä½œä¸ºæˆ‘ä»¬æ„é€ çš„contextå†…éƒ¨æ–¹æ³•å
    let fn = Symbol('thisFn') 
     // 1. å°†fnä½œä¸ºå±æ€§æ·»åŠ åˆ°contextä¸Š
    context[fn] = this // éšå¼ç»‘å®šï¼Œæ”¹å˜æ„é€ å‡½æ•°çš„è°ƒç”¨è€…é—´æ¥æ”¹å˜ this æŒ‡å‘
    // 2. å°†æŒ‚è½½ä»¥åçš„æ–¹æ³•è°ƒç”¨
    let res = context[fn](...args)  // è¿™é‡Œ..argså°†argsæ•°ç»„ï¼Œå˜ä¸ºå‚æ•°åˆ—è¡¨ï¼Œæ•°ç»„çš„æ‰©å±•è¿ç®—ç¬¦
    // 3. åˆ é™¤æ–°æ·»åŠ çš„å¯¹è±¡å±æ€§
    delete context[fn]
    // 4. è¿”å›è°ƒç”¨ç»“æœ
    return res
}
```

#### apply

```js
// func.apply(thisArg, [argsArray])
Function.prototype.myApply = function (thisArg, args) {
    let fn = Symbol('fn') // åˆ›å»ºä¸ªç‹¬ä¸€æ— äºŒçš„æ–¹æ³•å
    thisArg[fn] = this // æ–¹æ³•å˜æ¢æ‰§è¡Œå¯¹è±¡
    let res = thisArg[fn](...args) 
    delete thisArg[fn] // åˆ é™¤å¯¹è±¡å±æ€§
    return res
}
```

#### bind

- æ”¹å˜thisæŒ‡å‘
- è¿”å›ä¸€ä¸ªæ–°å‡½æ•°
- æ–°å‡½æ•°å¯èƒ½è¢«å½“åšæ„é€ å‡½æ•°è°ƒç”¨ï¼Œå‡½æ•°å¯èƒ½æœ‰è¿”å›å€¼
- å½“ bind è¿”å›çš„å‡½æ•°ä½œä¸ºæ„é€ å‡½æ•°çš„æ—¶å€™ï¼Œbind æ—¶æŒ‡å®šçš„ this å€¼ä¼šå¤±æ•ˆ
- ä¼ é€’å‚æ•°å¹¶æŸ¯é‡ŒåŒ–
- https://www.jianshu.com/p/b540e1e17f54 å‚è€ƒ
- https://github.com/mqyqingfeng/Blog/issues/12  å†´ç¾½

```js
// // ES2015 argumentsæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œç±»æ•°ç»„ï¼›
// const args = Array.from(arguments);
// const args = [...arguments];
// let new_array = old_array.concat(value1,value2,...)
// concatåé¢å‚æ•°å¯ä»¥æ˜¯æ•°ç»„ï¼Œä¹Ÿå¯ä»¥æ˜¯å‚æ•°æœ¬èº«

Function.prototype.myBind = function (context) {
    if(typeof this != 'function'){
        throw new TypeError('this is not a function')
    }
    const self = this
    const args = [...arguments].slice(1) // ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯thisï¼Œæˆªå–æ‰
    const fNOP = function () {}
    
    const fBound =  function () { // è¿”å›ä¸€ä¸ªç»‘å®šäº†thisæŒ‡å‘çš„æ–¹æ³•ï¼Œé—­åŒ…
        const newArgs = args.concat(...arguments)
        // _self.call(context, ...args.concat(...arguments)) å‚æ•°ä¸ºæ•°ç»„ï¼Œç”¨applyç®€å•
      	return self.apply(this instance of fNOP ? this : context, newArgs)
    }
    // 1.æ–¹æ³•1 åŸå‹å¼ç»§æ‰¿
    fNOP.prototype = this.prototype;
    fBound.prototype = new fNOP(); //ç»‘å®šåŸå‹ åŸå‹å¼ç»§æ‰¿
    // 2. æ–¹æ³•2: fBound.prototype = Object.create(this.prototype)
    
    return fBound;
}

// å»æ³¨é‡Š double
Function.prototype.bind2 = function (context) {
    // 1. åˆ¤æ–­è°ƒç”¨bindçš„æ˜¯å¦æ˜¯å‡½æ•°
    if (typeof this !== 'function') {
      throw new TypeError('this is not a function')
    }
    // 2. ä¿å­˜å½“å‰ç¯å¢ƒä¸Šä¸‹æ–‡ï¼Œå–æˆªå–thisåçš„ä¼ å…¥å‚æ•°
    const self = this  
    const args = [...arguments].slice(1)
    const fNOP = function () {}

    const fBound = function () {
      const newArgs = args.concat(...arguments)
      // 1.å½“ä½œä¸ºæ„é€ å‡½æ•° newæ“ä½œçš„æ—¶å€™ï¼ŒthisæŒ‡å‘å®ä¾‹ï¼Œå°†ç»‘å®šå‡½æ•°çš„thisæŒ‡å‘è¯¥å®ä¾‹ï¼Œå¯ä»¥è®©å®ä¾‹è·å¾—æ¥è‡ªç»‘å®šå‡½æ•°çš„å€¼
      // 2.å½“ä½œä¸ºæ™®é€šå‡½æ•°æ—¶ï¼Œå°†ç»‘å®šå‡½æ•°çš„thisæŒ‡å‘context
      return self.apply(this instanceof fNOP ? this : context, newArgs)
    }

    // 3.åŸå‹å¼ç»§æ‰¿
    fNOP.prototype = this.prototype
    fBound.prototype = new fNOP()
  // å¤åˆ¶åŸå‡½æ•°çš„prototypeç»™fBoundï¼Œ ä¸€äº›æƒ…å†µä¸‹å‡½æ•°æ²¡æœ‰prototypeï¼Œå¦‚ç®­å¤´å‡½æ•°
  // fBound.prototype.__proto__ = (fNOP.prototype=this.prototype)

    return fBound
}

//   fBound.prototype = this.prototype;
// ç›´æ¥ä¿®æ”¹ fBound.prototype çš„æ—¶å€™ï¼Œä¹Ÿä¼šç›´æ¥ä¿®æ”¹ç»‘å®šå‡½æ•°çš„ prototype
```

#### bind2

```js
// https://jsgodroad.com/interview/js/#%E6%89%8B%E5%86%99%E9%A2%98
Function.prototype.myBind = function (context) {
  var _this = this
  var args = [...arguments].slice(1)
  // è¿”å›ä¸€ä¸ªå‡½æ•°
  return function F() {
    // å› ä¸ºè¿”å›äº†ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ new F()ï¼Œæ‰€ä»¥éœ€è¦åˆ¤æ–­
    if (this instanceof F) {
      return new _this(...args, ...arguments)
    }
    return _this.apply(context, args.concat(...arguments))
  }
}
```

### ğŸ”¥bind3 new 2021-12-13

```js
Function.prototype.myBind = function(objThis, ...args) {
    if (typeof this !== 'function') {
        return new TypeError('what is trying to be bound is not callable')
    }
    const self = this // ä¿å­˜æºå‡½æ•°,ä»¥åŠå‚æ•°
    const fBound = function () {
        const newArgs = args.concat(...arguments)
        return self.apply(this instanceof fBound ? this : objThis, newArgs)
    }
    // ä¿®å¤å‡½æ•°æ²¡æœ‰prototypeçš„æƒ…å†µ // ç»´æŠ¤åŸå‹å…³ç³»
    if (this.prototype) {
        fBound.prototype = Object.create(this.prototype)
    }
    return fBound
}
// https://juejin.cn/post/6844903906279964686#heading-14
```



#### bind-polyfill-core-js

```js
//  Yes, it does work with `new (funcA.bind(thisArg, args))`
if (!Function.prototype.bind) (function(){
  var ArrayPrototypeSlice = Array.prototype.slice;
  Function.prototype.bind = function(otherThis) {
    if (typeof this !== 'function') {
      // closest thing possible to the ECMAScript 5
      // internal IsCallable function
      throw new TypeError('Function.prototype.bind - what is trying to be bound is not callable');
    }

    var baseArgs= ArrayPrototypeSlice.call(arguments, 1),
        baseArgsLength = baseArgs.length,
        fToBind = this,
        fNOP    = function() {},
        fBound  = function() {
          baseArgs.length = baseArgsLength; // reset to default base arguments
          baseArgs.push.apply(baseArgs, arguments);
          return fToBind.apply(
            // æ˜¯å¦è¢«newæ“ä½œç¬¦è°ƒç”¨ï¼Œæ˜¯çš„è¯å°±ç”¨æ–°åˆ›å»ºçš„thisæ›¿æ¢bindçš„this
                 fNOP.prototype.isPrototypeOf(this) ? this : otherThis, baseArgs
          );
        };

    if (this.prototype) {
      // Function.prototype doesn't have a prototype property
      fNOP.prototype = this.prototype;
    }
    // é˜²æ­¢newäº†å‡½æ•°åæ”¹å˜åŸå‹å¯¼è‡´åŸå‡½æ•°çš„åŸå‹è¢«ä¿®æ”¹
    fBound.prototype = new fNOP();

    return fBound;
  };
})();
```



## é˜²æŠ–å’ŒèŠ‚æµ

#### é˜²æŠ– debounce

- äº‹ä»¶å“åº”å‡½æ•°åœ¨ä¸€æ®µæ—¶é—´åæ‰æ‰§è¡Œ,å¦‚æœè¿™æ®µæ—¶é—´å†…å†æ¬¡è°ƒç”¨,åˆ™é‡æ–°è®¡ç®—ã€‚ åœ¨ä¸€å®šçš„æ—¶é—´é—´éš”å†…,å°†å¤šæ¬¡è§¦å‘å˜æˆä¸€æ¬¡è§¦å‘

##### åº”ç”¨åœºæ™¯

1. é™åˆ¶é¼ æ ‡è¿ç»­ç‚¹å‡»ï¼ˆæŒ‰é’®æäº¤ç­‰ï¼‰
2. Scrolläº‹ä»¶æ»šåŠ¨é˜²æŠ–
3. æœç´¢æ¡†è¾“å…¥æŸ¥è¯¢
4. æµè§ˆå™¨çª—å£ç¼©æ”¾ï¼Œresizeäº‹ä»¶

```js
// https://www.30secondsofcode.org/js/s/debounce ç›®å‰çœ‹è§æœ€ç®€å†™æ³•ï¼Œbestï¼
const debounce = (fn, ms = 0) => {
  let timeoutId
  return function(...args) { 
    // function(...args) restå‚æ•° ï¼Œå°†argsè½¬ä¸ºæ•°ç»„
    // å¯¹æ¯”æ•°ç»„çš„æ‰©å±•è¿ç®—æ³• fn.call(obj,...args) å«ä¹‰ä¸ä¸€æ ·, å°†argsè½¬ä¸ºå‚æ•°åˆ—è¡¨
    clearTimeout(timerId) // æ¯æ¬¡ç‚¹å‡»çš„æ—¶å€™æ¸…é™¤ä¸Šä¸€ä¸ªå®šæ—¶å™¨ï¼Œé‡æ–°è®¡æ—¶
    timeoutId = setTimeout(() => fn.apply(this,args), ms)
  }
}
```

#### èŠ‚æµ  throttle

- æŒç»­çš„è§¦å‘äº‹ä»¶,æ¯éš”ä¸€æ®µæ—¶é—´, åªæ‰§è¡Œä¸€æ¬¡ ï¼Œå‡å°‘ä¸€æ®µæ—¶é—´çš„è§¦å‘é¢‘ç‡

##### æ—¶é—´æˆ³ç‰ˆæœ¬

```js
const throttle = (fn, wait) => {
  	let pre = 0
    return function () {
      // Date.now || + new Date() || new Date().getTime() || new Date().valueOf()
      let now = Date.now()
      if (now - pre > = wait) {
        // applyç¬¬äºŒä¸ªå‚æ•°å¯ä»¥æ˜¯æ•°ç»„ï¼Œä¹Ÿå¯ä»¥æ˜¯ç±»æ•°ç»„å¯¹è±¡
        // æ‰€ä»¥å†™argumentsæ²¡æœ‰é—®é¢˜ï¼
        fn.apply(this,arguments)
        pre = Date.now() // å°†å½“å‰æ—¶é—´è®°å½•ï¼Œ ä½œä¸ºä¸‹ä¸€ä¸ªè®¡æ—¶èµ·ç‚¹
      }
    }
}
```

#### å®šæ—¶å™¨ç‰ˆæœ¬

```js
const throttle = (fn, wait) => {
  let timerId 
  return function () {
    if (!timerId) {
      // è¿™é‡Œç®­å¤´å‡½æ•°ï¼Œthisæœ¬èº«æŒ‡å‘ä¸Šå±‚
      timerId = setTimeout(() => {
        fn.apply(this, arguments)
        timerId = null
      }, wait)
    }
  }
}
//å†´ç¾½ https://github.com/mqyqingfeng/Blog/issues/26
```



## deepCloneæ·±æ‹·è´ !!!

#### æµ…æ‹·è´

1. Object.assign()
2. `...`æ‰©å±•è¿ç®—ç¬¦ **`let cloneObj = {...obj}` `let newArr = [...arr]`**
3. æ•°ç»„çš„Slice(), concat()

```js
const shallowClone = obj => Object.assign({}, obj);
```

#### æ·±æ‹·è´

##### ä¹ä¸ç‰ˆ

```js
 let newObj = JSON.parse( JSON.stringify( obj ) )
```

1. æ‹·è´å¯¹è±¡çš„å€¼ä¸­å¦‚æœæœ‰`å‡½æ•°`ã€`undefined`ã€`Symbol`ï¼ŒJSON.stringifyåºåˆ—åŒ–åçš„å­—ç¬¦ä¸²ä¸­ï¼Œè¿™ä¸ªé”®å€¼å¯¹ä¸¢å¤±
2. æ‹·è´Dateå¼•ç”¨ç±»å‹ä¼šå˜æˆå­—ç¬¦ä¸²
3. æ‹·è´RegExpä¼šå˜æˆç©ºå¯¹è±¡ `{}`
4. å¯¹è±¡ä¸­å«æœ‰ `NaN`ã€`Infinity` ä¼šå˜æˆ `null`
5. æ— æ³•æ‹·è´å¯¹è±¡çš„åŸå‹é“¾
6. æ— æ³•æ‹·è´ä¸å¯æšä¸¾çš„å±æ€§ å¦‚Symbol
7. æ— æ³•æ‹·è´å¯¹è±¡çš„å¾ªç¯å¼•ç”¨ ï¼Œ å³å¯¹è±¡æˆç¯ `obj[key] = obj`

##### ğŸ”¥ä¼˜åŒ–ç‰ˆ

- è€ƒè™‘ Dateã€RegExpç±»å‹ï¼Œ ç›´æ¥ç”Ÿæˆä¸€ä¸ªæ–°çš„å®ä¾‹è¿”å›
- è€ƒè™‘æ•°ç»„  `let target = Array.isArray(obj)? [] : {}`
- è€ƒè™‘å¾ªç¯å¼•ç”¨  åˆ©ç”¨WeakMapä½œä¸ºhashè¡¨ï¼Œ æ£€æµ‹åˆ°å¯¹è±¡å·²å­˜åœ¨äºå“ˆå¸Œè¡¨ä¸­ï¼Œå–å‡ºè¯¥å€¼è¿”å›å³å¯

- é’ˆå¯¹ä¸å¯æšä¸¾å±æ€§ä»¥åŠ Symbol ç±»å‹ï¼Œä½¿ç”¨ Reflect.ownKeys()

- å‡½æ•°éƒ¨åˆ†å¤ªå¤æ‚ï¼Œå‡½æ•°çš„åŸå‹ï¼Œå¤šå±‚æŸ¯é‡ŒåŒ–ç­‰

- é’ˆå¯¹Map, Set, Errorç­‰ï¼ŒObject.getOwnPropertyDescriptors(obj) ä¹Ÿä¸è€ƒè™‘

- é€’å½’çˆ†æ ˆé—®é¢˜ï¼Œæ”¹ç”¨å¾ªç¯è§£å†³ï¼Œå¹¿åº¦ä¼˜å…ˆ

-  [æ·±æ‹·è´çš„ç»ˆææ¢ç´¢ï¼ˆ99%çš„äººéƒ½ä¸çŸ¥é“ï¼‰](https://segmentfault.com/a/1190000016672263)

- [å¦‚ä½•å†™å‡ºä¸€ä¸ªæƒŠè‰³é¢è¯•å®˜çš„æ·±æ‹·è´?](https://juejin.cn/post/6844903929705136141#heading-4) 

  ```js
  RangeError: Maximum call stack size exceeded
  ```

  

```js
// æ£€æµ‹å¯¹è±¡ 
const isObject = (obj) => {
    return typeof obj === 'object' && obj != null  // !!obj
}

const deepClone = (obj, hash = new WeakMap()) => {
  // å€¼ç±»å‹ ç›´æ¥è¿”å›
  if (!isObject(obj)) return obj
  // Date, RegExp  constructorå®¹æ˜“è¢«ä¿®æ”¹ä¸¢å¤±ï¼Œè¢«è®¤ä¸ºä¸å®‰å…¨ï¼Œä¸æ¨èä½œä¸ºåˆ¤æ–­
  // instanceofå¥½ä¸€äº›
//  if (obj.constructor === Date) return new Date(obj)
//  if (obj.constructor === RegExp) return new RegExp(obj)
    if (obj instanceof Date) return new Date(obj)
    if (obj instanceof RegExp) return new RegExp(obj)
  // è§£å†³å¾ªç¯å¼•ç”¨ï¼ŒæŸ¥å“ˆå¸Œè¡¨
  if (hash.has(obj)) return hash.get(obj)
//     let allDesc = Object.getOwnPropertyDescriptors(obj)
//     let target = Object.create(Object.getPrototypeOf(obj),allDesc)
  let target = Array.isArray(obj) ? [] : {} // è€ƒè™‘æ•°ç»„
  hash.set(obj, target)
  
  Reflect.ownKeys(obj).forEach(key => {
    if (isObject(obj[key])) {
      target[key] = deepClone(obj[key], hash)
    } else {
      target[key] = obj[key]
    }
  })
  return target
}
```

1. [æ·±æ‹·è´çš„ç»ˆææ¢ç´¢](https://yanhaijing.com/javascript/2018/10/10/clone-deep/) 

## å®ç° (5).add(3).minus(2) åŠŸèƒ½

```js
Number.prototype.add = function(n) {
    if (typeof number !== 'number') {
        throw new Error('è¯·è¾“å…¥æ•°å­—ï½');
    }
  return this.valueOf() + n;
};
Number.prototype.minus = function(n) {
    if (typeof number !== 'number') {
        throw new Error('è¯·è¾“å…¥æ•°å­—ï½');
    }
  // return this - n 
  return this.valueOf() - n;
};
// (5).add(3).minus(2)
```



## å¦‚ä½•æ±‚æ•°ç»„æœ€å¤§å€¼å’Œæœ€å°å€¼

1. å¾ªç¯åMath.max
2. reduce
3. sortæ’åºåå–æœ€å
4. ES6 ... + Math.max

```js
// 1. Math.max
var arr = [6, 4, 1, 8, 2, 11, 23];

var result = arr[0];
for (var i = 1; i < arr.length; i++) {
    result =  Math.max(result, arr[i]);
}
console.log(result);
// 2. reduce
var arr = [6, 4, 1, 8, 2, 11, 23];

function max(prev, next) {
    return Math.max(prev, next);
}
console.log(arr.reduce(max));
// 3. sort
var arr = [6, 4, 1, 8, 2, 11, 23];

arr.sort(function(a,b){return a - b;});
console.log(arr[arr.length - 1])
// 4. ES6 ...
var arr = [6, 4, 1, 8, 2, 11, 23];
console.log(Math.max.apply(null, arr))
```



## æ•°ç»„å»é‡

- åŒé‡forå¾ªç¯
- new Set
- indexOf
- array.filter + indexOf
- sortæ’åº + ç›¸é‚»å…ƒç´ å¯¹æ¯”
- Object é”®å€¼å¯¹ obj.hasOwnProperty

```js
// 0. åŒé‡forå¾ªç¯

// 1. Seté›†åˆï¼Œä¸èƒ½æœ‰é‡å¤å€¼
const newArr2 = Array.from(new Set(arr))
// ç®€åŒ–
const newArr = [...new Set(arr)]

// 2. indexOf
function resetArr(arr) {
  let res = []
  arr.forEach(item => {
    if (res.indexOf(item) === -1) {
      res.push(item)
    }
  })
  return res
}
// indexOf()æ–¹æ³•è¿”å›åœ¨æ•°ç»„ä¸­å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªç»™å®šå…ƒç´ çš„ç¬¬ä¸€ä¸ªç´¢å¼•ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿”å›-1
// filter() æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°æ•°ç»„, å…¶åŒ…å«é€šè¿‡æ‰€æä¾›å‡½æ•°å®ç°çš„æµ‹è¯•çš„æ‰€æœ‰å…ƒç´ ã€‚ 

// 3. array.filter + indexOf
const unique = (arr) => {
  let res =  arr.filter((item,index) => {
    	// å¦‚æœç¬¬ä¸€æ¬¡å‡ºç°ï¼Œç›¸ç­‰
    return arr.indexOf(item) === index 
  })
  return res
}
// 4. sortæ’åºåç›¸é‚»å…ƒç´ å¯¹æ¯”
function unique(arr) {
    if (!Array.isArray(arr)) {
        console.log('type error!')
        return
    }
    arr = arr.sort()
    let res = []
    // iä»1å¼€å§‹ç®— arr[i-1]
    for (let i = 0; i < arr.length; i++) {
        if (arr[i] !== arr[i-1]) {
            res.push(arr[i])
        }
    }
    return res
}
// 5.obj.hasOwnProperty

// æµ‹è¯•
const arr = [1, 1, 2, 3, 3]
console.log(resetArr(arr)) // [1, 2, 3]
// https://github.com/mqyqingfeng/Blog/issues/27
```

## æ•°ç»„æ‰å¹³åŒ– flatten

[é¢è¯•å®˜è¿ç¯è¿½é—®ï¼šæ•°ç»„æ‹å¹³ï¼ˆæ‰å¹³åŒ–ï¼‰ flat æ–¹æ³•å®ç°](https://juejin.cn/post/6844904025993773063)

```
var arr = [1, [2, [3, 4]]];
console.log(flatten(arr)) // [1, 2, 3, 4]
```

### ğŸ”¥å¾ªç¯é€’å½’

```js
// æ–¹æ³• 1
var arr = [1, [2, [3, 4]]];

function flatten(arr) {
    let result = []
    for (let i = 0; i < arr.length; i++) {
        if (Array.isArray(arr[i])) {
            result = result.concat(flatten(arr[i]))
        } else {
            result.push(arr[i])
        }
    }
    return result
}


console.log(flatten(arr))

```

### toString

å¦‚æœæ•°ç»„å…ƒç´ éƒ½æ˜¯Number, å¯ä»¥ä½¿ç”¨ï¼›ä½†ä¸æ¨èè¿™ç§ toString+splitæ–¹å¼

```js
[1, [2, [3, 4]]].toString() // "1,2,3,4"
// åœºæ™¯å´éå¸¸æœ‰é™ï¼Œå¦‚æœæ•°ç»„æ˜¯ [1, '1', 2, '2'] æ­¤æ–¹æ³•ä¸é€‚åˆ
// æ‰å¹³åŒ–ä¸æ”¹å˜åŸæ•°æ®ç±»å‹
```

```js
// æ–¹æ³•2
var arr = [1, [2, [3, 4]]];

function flatten(arr) {
    return arr.toString().split(',').map(function(item){
        return +item //è½¬ä¸ºNumber
    })
}

console.log(flatten(arr))
```

### ğŸ”¥ç”¨reduceå®ç°flat

```js
// æ–¹æ³•3
var arr = [1, [2, [3, 4]]];

function flatten(arr) {
    return arr.reduce(function(prev, next){
        return prev.concat(Array.isArray(next) ? flatten(next) : next)
    }, [])
}

// ç®€åŒ–
const flatten = (arr) => {
  return arr.reduce((pre, cur) => {
    return pre.concat(Array.isArray(cur) ? flatten(cur) : cur)
  },[])
}

console.log(flatten(arr))

// ç†è§£ 
// var arr = [2, [3, 4]];
// pre  cur
// []   2       0    [2]
// [2]  [3,4]   1    [2] wait 

// []   3       0    [3]
// [3]  4       1    [3, 4]

// [2]  [3,4]       [2,3,4]
```

### ES6 ... 

==[].concat(...arr)==

```js
var arr = [1, [2, [3, 4]]];
console.log([].concat(...arr)); // [1, 2, [3, 4]]
// è¿™æ—¶ï¼Œåªå¯ä»¥æ‰å¹³ä¸€å±‚ï¼Œé¡ºç€è¿™ä¸ªæ–¹æ³•

// æ–¹æ³•4
var arr = [1, [2, [3, 4]]];

function flatten(arr) {

    while (arr.some(item => Array.isArray(item))) {
        arr = [].concat(...arr);
    }

    return arr;
}

console.log(flatten(arr))
```

## ğŸ”¥æŸ¯é‡ŒåŒ– curry

æŸ¯é‡ŒåŒ–æ˜¯ä¸€ç§å°†ä½¿ç”¨å¤šä¸ªå‚æ•°çš„ä¸€ä¸ªå‡½æ•°è½¬æ¢æˆä¸€ç³»åˆ—ä½¿ç”¨ä¸€ä¸ªå‚æ•°çš„å‡½æ•°çš„æŠ€æœ¯



```js
const curry = (fn, ...args) =>{
  // å½“å‚æ•°ä¸fnå‚æ•°ç›¸åŒï¼Œåˆ™ç›´æ¥æ‰§è¡Œå‡½æ•° fn.length å½¢å‚ä¸ªæ•°
		if (args.length >= fn.length) return fn(...args)
  // å¦åˆ™è¿”å›å‡½æ•°ï¼Œåˆå¹¶å‚æ•°ï¼Œå¹¶ç»§ç»­è‡ªåŠ¨æŸ¯é‡ŒåŒ–
    return (...args2) => {
        return curry(fn, ...args, ...args2);
    }
}
```

## å‡½æ•°ç»„åˆ compose

```js
 // reduxä¸­çš„å®ç° ä¸ä¸€å®šå‡†ç¡® ï¼Œå¾…æ•´ç†
// https://github.com/mqyqingfeng/Blog/issues/45
function compose(...funcs) {
  if (funcs.length === 0) {
    return arg => arg
  }

  if (funcs.length === 1) {
    return funcs[0]
  }

  return funcs.reduce((a, b) => (...args) => a(b(...args)))
}

```



## EventEmitter

https://juejin.cn/post/7031322059414175774#heading-16

## åƒä½åˆ†éš”ç¬¦

https://juejin.cn/post/6844903911686406158#heading-19

## å¼‚æ­¥æ§åˆ¶å¹¶å‘æ•°

## ES5ç»§æ‰¿ï¼ˆå¯„ç”Ÿç»„åˆç»§æ‰¿ï¼‰

## å‚è€ƒ

1. [å†´ç¾½çš„åšå®¢](https://github.com/mqyqingfeng/Blog)
2. [å‰ç«¯å¿…åˆ·æ‰‹å†™é¢˜ç³»åˆ— [22]](https://juejin.cn/post/7000374304727089159)
